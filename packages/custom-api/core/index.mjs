(function(){ try {var elementStyle = document.createElement('style'); elementStyle.appendChild(document.createTextNode(".mfish-http-body-param .page-config[data-v-fcc0f379] {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n.mfish-http-body-param .page-config-label[data-v-fcc0f379] {\n  font-weight: 700;\n  width: 150px;\n}\n.mfish-config-wrapper[data-v-1359685a] {\n  display: flex;\n  align-items: center;\n  padding: 6px 12px 6px 12px;\n}\n.mfish-config-wrapper.active[data-v-1359685a] {\n  border-bottom: 1px dashed var(--main-color);\n}\n.mfish-config-wrapper .select[data-v-1359685a] {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  margin-right: -16px;\n  height: 16px;\n  width: 16px;\n}\n.mfish-config-wrapper .title[data-v-1359685a] {\n  padding: 0 6px 0 6px;\n  font-size: 12px;\n  font-weight: bold;\n  width: 60px;\n}\n.mfish-config-wrapper .config[data-v-1359685a] {\n  padding-left: 12px;\n  display: flex;\n  align-items: center;\n  flex-wrap: wrap;\n}\n.mfish-config-wrapper .full[data-v-1359685a] {\n  flex: 1;\n}\n.mfish-select-fields-check-wrapper[data-v-e2824c60] {\n  padding: 4px 8px;\n}\n.mfish-table-fields[data-v-4ff39b8d] {\n  display: flex;\n}\n.mfish-config-button[data-v-e48e0292] {\n  display: flex;\n  align-items: center;\n  transition: background 0.8s ease;\n}\n.mfish-config-button .show-title[data-v-e48e0292] {\n  display: none;\n}\n.mfish-config-button[data-v-e48e0292]:hover {\n  color: #ffffff;\n  background: var(--hover-color--);\n}\n.mfish-config-button:hover .show-title[data-v-e48e0292] {\n  display: inline-block;\n}\n[data-theme=\"dark\"] .mfish-table-joins .right-table .placeholder[data-v-abdb59da] {\n  color: rgba(255, 255, 255, 0.2);\n}\n.mfish-table-joins .condition[data-v-abdb59da] {\n  flex-shrink: 0;\n  padding: 0 12px 0 12px;\n}\n.mfish-table-joins .left-table[data-v-abdb59da] {\n  max-width: 180px;\n}\n.mfish-table-joins .right-table[data-v-abdb59da] {\n  display: flex;\n  max-width: 260px;\n}\n.mfish-table-joins .right-table .placeholder[data-v-abdb59da] {\n  color: rgba(0, 0, 0, 0.2);\n}\n.mfish-table-joins .input-select[data-v-abdb59da] {\n  flex-shrink: 0;\n  width: 180px;\n}\n.mfish-filter-variable-select-option[data-v-dff0d91d] {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n.mfish-filter-value[data-v-1b7847a8] {\n  display: flex;\n  flex-direction: column;\n}\n.mfish-table-aggregate .groupIcon[data-v-3519b7ea] {\n  margin-left: 6px;\n}\n.mfish-table-aggregate .group[data-v-3519b7ea] {\n  font-size: 12px;\n  font-weight: bold;\n  margin: 0 6px 0 6px;\n}\n[data-theme=\"dark\"] .mfish-formula-management[data-v-5fa7a95b] {\n  background-color: #121212;\n}\n[data-theme=\"dark\"] .mfish-formula-management .mfish-formula-management-card-item[data-v-5fa7a95b] {\n  background: var(--sider-bg-color);\n}\n[data-theme=\"dark\"] .mfish-formula-management .mfish-formula-management-card-item[data-v-5fa7a95b]:hover {\n  box-shadow: 0 0 8px 4px rgba(255, 255, 255, 0.1);\n}\n.mfish-formula-management[data-v-5fa7a95b] {\n  background-color: #fff;\n}\n.mfish-formula-management-left[data-v-5fa7a95b] {\n  padding: 6px;\n}\n.mfish-formula-management-right[data-v-5fa7a95b] {\n  margin-left: 15px;\n  display: flex;\n  flex-direction: column;\n}\n.mfish-formula-management-card[data-v-5fa7a95b] {\n  margin: 5px 10px 10px 0;\n}\n.mfish-formula-management-card-item[data-v-5fa7a95b] {\n  height: 70px;\n  background: #fff;\n  border-radius: 6px;\n  box-shadow: 0 0 4px 2px rgba(0, 0, 0, 0.05);\n  display: flex;\n  align-items: center;\n  padding-left: 10px;\n  transition: all 0.3s ease-in;\n}\n.mfish-formula-management-card-item[data-v-5fa7a95b]:hover {\n  box-shadow: 0 0 8px 4px rgba(0, 0, 0, 0.1);\n  transform: scale(1.01);\n  cursor: pointer;\n}\n.mfish-formula-management-card-item-info[data-v-5fa7a95b] {\n  flex: 1;\n  width: 0;\n  display: flex;\n  flex-direction: column;\n}\n.mfish-formula-management-card-item-info > span[data-v-5fa7a95b] {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n[data-theme=\"dark\"] .mfish-select-formula-drop-button .placeholder[data-v-983d37a1] {\n  color: rgba(255, 255, 255, 0.25);\n}\n.mfish-select-formula-drop-button[data-v-983d37a1] {\n  width: 100%;\n  display: flex;\n  align-items: center;\n}\n.mfish-select-formula-drop-button .content[data-v-983d37a1] {\n  width: 100%;\n  text-align: left;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.mfish-select-formula-drop-button .placeholder[data-v-983d37a1] {\n  color: rgba(0, 0, 0, 0.25);\n}\n.mfish-select-formula-ok-button[data-v-983d37a1] {\n  display: flex;\n  justify-content: flex-end;\n}\n.mfish-formula-compact[data-v-a24bef98] {\n  display: flex;\n}\n.mfish-formula-compact .radio-group[data-v-a24bef98] {\n  display: flex;\n}\n.mfish-formula-compact .radio-group[data-v-a24bef98] > * {\n  display: flex;\n  width: 32px;\n  align-items: center;\n  justify-content: center;\n}\n.mfish-formula-compact .radio-group[data-v-a24bef98] :last-child {\n  border-start-end-radius: 0;\n  border-end-end-radius: 0;\n  border-left: none;\n}\n.mfish-formula-compact .formula-select[data-v-a24bef98] {\n  flex: 1;\n  min-width: 150px;\n}\n.mfish-formula-compact .formula-select[data-v-a24bef98] :only-child {\n  border-end-start-radius: 0;\n  border-start-start-radius: 0;\n  border-left: none;\n}\n.mfish-formula-compact .formula-select .input-com[data-v-a24bef98] {\n  height: 100%;\n  width: 100%;\n}\n.mfish-formula-compact .formula-select .select-com[data-v-a24bef98] {\n  width: 100%;\n}\n.mfish-formula-compact .formula-select .select-com[data-v-a24bef98] :first-child {\n  border-end-start-radius: 0;\n  border-start-start-radius: 0;\n  border-left: none;\n}\n.mfish-formula-compact .formula-select-show[data-v-a24bef98] {\n  flex: 1;\n  min-width: 150px;\n}\n.mfish-formula-compact .formula-select-show .input-com[data-v-a24bef98] {\n  height: 100%;\n  width: 100%;\n}\n.mfish-formula-config[data-v-cbde54bb] {\n  flex: 1;\n}\n.mfish-formula-config .formula[data-v-cbde54bb] {\n  display: flex;\n}\n.mfish-formula-config .formula .main[data-v-cbde54bb] {\n  flex: 1;\n}\n.mfish-formula-config .param[data-v-cbde54bb] {\n  margin-top: 6px;\n  display: flex;\n  align-items: flex-start;\n  flex: 1;\n}\n.mfish-formula-config .param .icon[data-v-cbde54bb] {\n  margin-top: 8px;\n}\n.mfish-formula-config .param .title[data-v-cbde54bb] {\n  padding: 4px 6px 0 6px;\n  width: 80px;\n  min-width: 80px;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n}\n.mfish-formula-config .add[data-v-cbde54bb] {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-top: 6px;\n}\n.mfish-col-modal-slot-tag[data-v-ffce7698] {\n  width: 24px;\n  height: 24px;\n  display: flex;\n  margin-right: 8px;\n  align-items: center;\n  justify-content: center;\n  cursor: move;\n}\n[data-theme=\"dark\"] .mfish-api-config[data-v-6e75c78b] {\n  box-shadow: 0 0 8px 4px var(--header-bg-color);\n}\n[data-theme=\"dark\"] .mfish-api-config .inner[data-v-6e75c78b] {\n  border: 1px dashed #303030;\n  box-shadow: none;\n}\n[data-theme=\"dark\"] .mfish-api-config .btn-bar[data-v-6e75c78b] {\n  border-top: 1px solid #565353;\n}\n.mfish-api-config[data-v-6e75c78b] {\n  border-radius: 6px;\n  padding: 6px 10px;\n  margin-top: 6px;\n  margin-bottom: 6px;\n  box-shadow: 0 0 8px 4px rgba(0, 0, 0, 0.08);\n}\n.mfish-api-config .select[data-v-6e75c78b] {\n  position: relative;\n  display: flex;\n  margin: -6px 0 -10px -10px;\n  border-radius: 6px 0 0 0;\n  height: 16px;\n  width: 20px;\n  clip-path: polygon(0 0, 0 100%, 100% 0);\n}\n.mfish-api-config .inner[data-v-6e75c78b] {\n  border: 1px dashed #d9d9d9;\n  box-shadow: none;\n}\n.mfish-api-config .inner.active[data-v-6e75c78b] {\n  border: 1px dashed var(--main-color);\n}\n.mfish-api-config .btn-bar[data-v-6e75c78b] {\n  display: flex;\n  border-top: 1px solid #d9d9d9;\n  margin-top: 6px;\n}\n.mfish-api-config .btn-bar .config-button[data-v-6e75c78b] {\n  margin: 6px 6px 0 0;\n  padding: 10px;\n}")); document.head.appendChild(elementStyle);} catch(e) {console.error('vite-plugin-css-injected-by-js', e);} })();import { defHttp as e } from "@mfish/core/utils/http/axios";
import { debounce as l, cloneDeep as a } from "lodash-es";
import { defineStore as t } from "pinia";
import { defineComponent as o, ref as n, watch as u, nextTick as i, createBlock as r, openBlock as s, unref as d, withCtx as c, createCommentVNode as p, h as m, useTemplateRef as f, reactive as v, resolveComponent as g, createElementBlock as y, normalizeClass as h, createVNode as b, createElementVNode as q, normalizeStyle as k, toDisplayString as C, renderSlot as _, computed as M, createTextVNode as Q, Fragment as S, renderList as T, onMounted as N, mergeProps as w, withModifiers as F, toRaw as x, onBeforeMount as A, createSlots as R, toRefs as I } from "vue";
import { ConfigGroup as $ } from "@mfish/nocode";
import { useTable as O, BasicTable as j, TableAction as B } from "@mfish/core/components/Table";
import { buildUUID as D } from "@mfish/core/utils/Uuid";
import { Input as P, Checkbox as z, InputNumber as E, Divider as V, Tooltip as U, Button as L, Dropdown as H, Menu as K, Cascader as J, Select as G, Radio as W, Form as Y, DatePicker as X, RangePicker as Z, Switch as ee, Breadcrumb as le, Descriptions as ae, Row as te, Col as oe, Card as ne, Drawer as ue, Alert as ie, Tag as re } from "ant-design-vue";
import { useDesign as se, useRootSetting as de, useMessage as ce } from "@mfish/core/hooks";
import { DeleteOutlined as pe, CaretRightOutlined as me, CheckOutlined as fe } from "@ant-design/icons-vue";
import { Icon as ve, IconFont as ge } from "@mfish/core/components/Icon";
import { ScrollContainer as ye } from "@mfish/core/components/Container";
import { DraggableInput as he } from "@mfish/core/components/Draggable";
import { BasicModal as be, useModalInner as qe, useModal as ke } from "@mfish/core/components/Modal";
import { BasicForm as Ce, useForm as _e } from "@mfish/core/components/Form";
import { BasicTree as Me } from "@mfish/core/components/Tree";
import { Split as Qe } from "@mfish/core/components/Split";
import { ThemeEnum as Se } from "@mfish/core/enums";
import { useDebounceFn as Te, useFocus as Ne, useClipboard as we } from "@vueuse/core";
import { CodeEditor as Fe, MODE as xe } from "@mfish/core/components/CodeEditor";
const Ae = (l2) => e.get({ url: "/nocode/apiFolder/tree", params: l2 }), Re = (l2) => e.get({ url: "/nocode/apiFolder", params: l2 });
function Ie(l2) {
  return e.download({ url: "/nocode/apiFolder/export", params: l2 });
}
function $e(l2) {
  return e.post({ url: "/nocode/apiFolder", params: l2 }, { successMessageMode: "message" });
}
function Oe(l2) {
  return e.put({ url: "/nocode/apiFolder", params: l2 }, { successMessageMode: "message" });
}
function je(l2) {
  return e.put({ url: "/nocode/apiFolder/drag", params: l2 }, { successMessageMode: "message" });
}
function Be(l2) {
  return e.delete({ url: `/nocode/apiFolder/${l2}` }, { successMessageMode: "message" });
}
const De = (l2) => e.get({ url: "/nocode/apiParams", params: l2 });
function Pe(l2) {
  return e.download({ url: "/nocode/apiParams/export", params: l2 });
}
function ze(l2) {
  return e.post({ url: "/nocode/apiParams", params: l2 }, { successMessageMode: "message" });
}
function Ee(l2) {
  return e.put({ url: "/nocode/apiParams", params: l2 }, { successMessageMode: "message" });
}
function Ve(l2) {
  return e.delete({ url: `/nocode/apiParams/${l2}` }, { successMessageMode: "message" });
}
const Ue = (l2) => e.get({ url: "/nocode/formulaInfo/tree", params: l2 }), Le = (l2) => e.get({ url: `/nocode/formulaParam/${l2}` }), He = (l2) => e.get({ url: "/nocode/formulaInfo", params: l2 });
function Ke(l2) {
  return e.get({ url: `/nocode/formulaInfo/${l2}` });
}
function Je(l2) {
  return e.download({ url: "/nocode/formulaInfo/export", params: l2 });
}
function Ge(l2) {
  return e.post({ url: "/nocode/formulaInfo", params: l2 }, { successMessageMode: "message" });
}
function We(l2) {
  return e.put({ url: "/nocode/formulaInfo", params: l2 }, { successMessageMode: "message" });
}
function Ye(l2) {
  return e.delete({ url: `/nocode/formulaInfo/${l2}` }, { successMessageMode: "message" });
}
function Xe(l2) {
  return e.delete({ url: "/nocode/formulaInfo/batch/" + l2 }, { successMessageMode: "message" });
}
const Ze = () => "/nocode/mfApi/api", el = (l2) => e.get({ url: "/nocode/mfApi", params: l2 });
function ll(l2) {
  return e.download({ url: "/nocode/mfApi/export", params: l2 });
}
function al(l2) {
  return e.post({ url: "/nocode/mfApi", params: l2 }, { successMessageMode: "message" });
}
function tl(l2) {
  return e.put({ url: "/nocode/mfApi", params: l2 }, { successMessageMode: "message" });
}
function ol(l2) {
  return e.delete({ url: `/nocode/mfApi/${l2}` }, { successMessageMode: "message" });
}
function nl(l2) {
  return e.get({ url: `/nocode/mfApi/${l2}` });
}
function ul(l2) {
  return e.post({ url: "/nocode/mfApi/sql", params: l2 }, { errorMessageMode: "message" });
}
function il(l2, a2) {
  return e.post({ url: `/nocode/mfApi/data?pageNum=${a2.pageNum}&pageSize=${a2.pageSize}`, params: l2 }, { errorMessageMode: "message" });
}
function rl(l2, a2) {
  return e.post({ url: `/nocode/mfApi/formulaTest?pageNum=${a2.pageNum}&pageSize=${a2.pageSize}`, params: l2 }, { errorMessageMode: "message" });
}
function sl(l2) {
  return e.post({ url: "/nocode/mfApi/fields", params: l2 }, { errorMessageMode: "message" });
}
const dl = (l2) => e.get({ url: "/nocode/mfApi/headers", params: l2 });
function cl(l2) {
  return e.get({ url: `/nocode/mfApi/fields/${l2}` }, { errorMessageMode: "message" });
}
function pl(l2, a2, t2) {
  return e.get({ url: `/nocode/mfApi/table/${l2}?pageNum=${a2.pageNum}&pageSize=${a2.pageSize}`, params: t2 }, { errorMessageMode: "message" });
}
function ml(l2, a2, t2) {
  return e.get({ url: `/nocode/mfApi/api/${l2}`, params: { ...a2, ...t2 } }, { errorMessageMode: "message" });
}
function fl(l2, a2, t2) {
  return e.put({ url: "/nocode/mfApi/field/rename", params: { id: l2, colName: a2, newName: t2 } }, { successMessageMode: "message" });
}
var vl = ((e2) => (e2.error = "error", e2.eq = "=", e2.ne = "!=", e2.gt = ">", e2.ge = ">=", e2.lt = "<", e2.le = "<=", e2.between = "between", e2.isNull = "isNull", e2.isNotNull = "isNotNull", e2.like = "like", e2.notLike = "notLike", e2.likeLeft = "likeLeft", e2.likeRight = "likeRight", e2))(vl || {}), gl = ((e2) => (e2.count = "计数", e2.sum = "求和", e2.avg = "平均", e2.max = "最大", e2.min = "最小", e2))(gl || {}), yl = ((e2) => (e2.formula = "formula", e2.operator = "operator", e2.field = "field", e2.param = "param", e2))(yl || {});
const hl = (e2, a2, t2) => ({ CtrlKeysEnum: { s: l(() => t2(), 150), z: l(() => e2(), 150) }, CtrlShiftKeysEnum: { z: l(() => a2(), 150) } }), bl = t("custom-api", { state: () => ({ sourceId: "", sourceType: 0, tableName: "", tableFields: [], tableList: [], tableFieldsMap: /* @__PURE__ */ new Map(), variables: [], level: 1, fieldsChange: 1, showData: false, showDataLevel: "", formulaMap: /* @__PURE__ */ new Map(), httpParams: void 0 }), getters: { getSourceId() {
  return this.sourceId;
}, getSourceType() {
  return this.sourceType;
}, getTableName() {
  return this.tableName;
}, getTableFields() {
  return this.tableFields;
}, getTableList() {
  return this.tableList;
}, getTableFieldsMap() {
  return this.tableFieldsMap;
}, getVariables() {
  return this.variables;
}, getLevel() {
  return this.level;
}, getFieldsChange() {
  return this.fieldsChange;
}, getShowData() {
  return this.showData;
}, getShowDataLevel() {
  return this.showDataLevel;
}, getFormulaMap() {
  return this.formulaMap;
}, getHttpParams() {
  return this.httpParams;
} }, actions: { setSourceId(e2) {
  this.sourceId = e2;
}, setSourceType(e2) {
  this.sourceType = e2;
}, setTableName(e2) {
  e2 && (this.tableName = e2);
}, async setTableFields(e2, l2, a2) {
  return l2 ? (this.tableFields = await dl({ sourceId: e2, tableName: l2, params: a2, sourceType: this.sourceType }), this.tableFields) : [];
}, setTableList(e2) {
  e2?.list.length > 0 && (this.tableList = e2.list);
}, setLevel(e2) {
  this.level = e2;
}, setFieldsChange(e2) {
  e2 < this.getLevel && this.fieldsChange++;
}, addTableFieldsMap(e2, l2) {
  e2 && this.tableFieldsMap.set(e2, l2);
}, getTableFieldsByName(e2) {
  return e2 && this.tableFieldsMap.get(e2) || [];
}, setShowData(e2) {
  this.showData = e2;
}, setShowDataLevel(e2) {
  this.showDataLevel = e2;
}, async setFormulaMap() {
  if (this.formulaMap && this.formulaMap.size > 0) return;
  (await He({ pageNum: 1, pageSize: 1e4 })).list.forEach((e2) => {
    const l2 = `${e2.categoryId},${e2.id}`;
    this.formulaMap.set(l2, { ...e2, key: l2 });
  });
}, getFormula(e2) {
  return this.formulaMap.get(e2);
}, setHttpParams(e2) {
  this.httpParams = e2;
} } }), ql = "__API_SAVE__", kl = "公式结果";
var Cl = ((e2) => (e2.QUERY_SQL = "api_config:query_sql", e2.QUERY_DATA = "api_config:query_data", e2))(Cl || {});
const _l = async (e2) => {
  const l2 = bl();
  if (!e2?.sqlQuery) return [];
  const a2 = { sourceId: l2.getSourceId, sourceType: l2.getSourceType, sqlQuery: e2.sqlQuery }, t2 = await sl(a2);
  return t2 && t2.forEach((l3) => l3.tableAlias = e2.sourceTable), t2;
}, Ml = (e2) => e2 && (e2?.aggregates && e2.aggregates.length > 0 || e2.groups && e2.groups.length > 0 || e2.customColumns && e2.customColumns.length > 0), Ql = (e2, l2) => l2 === bl().getLevel && Ml(e2), Sl = (e2, l2, a2) => {
  e2 && e2.emit("api_config:query_data", { sqlQuery: l2, level: a2 });
}, Tl = (e2) => {
  const l2 = /* @__PURE__ */ new Set(), a2 = (e3, l3) => {
    e3.filters && e3.filters.length > 0 && e3.filters.forEach((e4) => {
      "1" === e4.valueType && e4.value && l3.add(e4.value);
    }), e3.sqlQuery && a2(e3.sqlQuery, l3);
  };
  return a2(e2, l2), l2;
}, Nl = async (e2) => {
  const l2 = bl(), a2 = [...Tl(e2)].reduce((e3, l3) => (l3 && (e3[l3] = "1"), e3), {});
  return await ul({ sourceId: l2.getSourceId, sourceType: l2.getSourceType, sqlQuery: e2 || {}, params: a2 });
};
function wl(e2) {
  switch (e2) {
    case "NUMBER":
      return "ant-design:field-number-outlined";
    case "DATE":
      return "ant-design:field-time-outlined";
    default:
      return "ant-design:field-string-outlined";
  }
}
const Fl = o({ __name: "HttpParamConfig", props: { httpParams: { type: Array, default: () => [] }, readOnly: { type: Boolean, default: false } }, setup(e2, { expose: l2 }) {
  const t2 = e2, o2 = n([]), f2 = [{ title: "参数名称", dataIndex: "key", align: "left", customCell: (e3) => ({ onClick: () => C2(e3.id, "key") }), customRender: ({ record: e3, index: l3 }) => t2.readOnly || k2.value.id !== e3.id || "key" !== k2.value.column ? e3.key : m(P, { ref: q2, defaultValue: e3.key, onChange: (e4) => M2(e4, l3), onBlur: (e4) => _2(l3, "key", e4.target?.value), onPressEnter: (e4) => _2(l3, "key", e4.target?.value), onKeydown: (l4) => {
    setTimeout(() => {
      "Tab" === l4.key && C2(e3.id, "value");
    }, 10);
  } }) }, { title: "参数值", dataIndex: "value", align: "left", customCell: (e3) => ({ onClick: () => C2(e3.id, "value") }), customRender: ({ record: e3, index: l3 }) => k2.value.id === e3.id && "value" === k2.value.column ? m(P, { ref: q2, defaultValue: e3.value, onChange: (e4) => M2(e4, l3), onBlur: (e4) => _2(l3, "value", e4.target?.value), onPressEnter: (e4) => _2(l3, "value", e4.target?.value), onKeydown: (e4) => {
    setTimeout(() => {
      if ("Tab" === e4.key) {
        if (b2().length <= l3 + 1) return;
        C2(b2()[l3 + 1].id, "key");
      }
    }, 10);
  } }) : e3.value }, { title: "是否必须", dataIndex: "isRequired", align: "center", customRender: ({ record: e3 }) => m(z, { checked: e3.isRequired, disabled: t2.readOnly, onChange: (l3) => {
    e3.isRequired = l3.target.checked;
  } }) }], [v2, { insertTableDataRecord: g2, deleteTableDataRecord: y2, setTableData: h2, getDataSource: b2 }] = O({ title: "", rowKey: "id", columns: f2, bordered: true, showIndexColumn: false, maxHeight: 300, pagination: false, canResize: false, rowSelection: { selectedRowKeys: o2.value, onChange: (e3) => {
    o2.value = e3;
  }, getCheckboxProps: (e3) => ({ disabled: !e3.key && t2.readOnly }) }, actionColumn: t2.readOnly ? void 0 : { width: 40, title: "", dataIndex: "action" } });
  u(() => t2.httpParams, (e3) => {
    i().then(() => {
      h2([...e3]), i().then(() => {
        t2.readOnly || Q2(), o2.value.push(...e3.filter((e4) => e4.checked).map((e4) => e4.id));
      });
    });
  }, { immediate: true });
  const q2 = n(), k2 = n({ id: null, column: null }), C2 = async (e3, l3) => {
    k2.value = { id: e3, column: l3 }, await i(), q2.value?.focus();
  }, _2 = (e3, l3, a2) => {
    const t3 = b2();
    t3.length <= e3 || (k2.value = { id: null, column: null }, t3[e3][l3] = a2);
  }, M2 = (e3, l3) => {
    e3.preventDefault(), e3.stopPropagation();
    const a2 = b2()[l3];
    if (a2.checked = false, e3.target.value && (a2.checked = true, o2.value.includes(a2.id) || o2.value.push(a2.id), t2.readOnly || e3.target._value || l3 !== b2().length - 1 || Q2()), !e3.target.value) {
      const e4 = o2.value.indexOf(a2.id);
      -1 !== e4 && o2.value.splice(e4, 1);
    }
  };
  function Q2() {
    const e3 = { id: D(), key: "", value: "", checked: false, isRequired: false };
    g2(e3, b2().length);
  }
  function S2(e3) {
    y2(e3.id);
  }
  return l2({ getValue: function() {
    const e3 = a(b2());
    return e3.forEach((e4) => {
      e4.checked = o2.value.includes(e4.id);
    }), e3.filter((e4) => !!e4.key);
  } }), (e3, l3) => (s(), r(d(j), { onRegister: d(v2) }, { bodyCell: c(({ column: e4, record: l4, index: a2 }) => ["action" === e4.key ? (s(), r(d(B), { key: 0, actions: [{ icon: "ant-design:delete-outlined", color: "error", onClick: S2.bind(null, l4), ifShow: !(!l4.key && a2 === d(b2)().length - 1) }] }, null, 8, ["actions"])) : p("", true)]), _: 1 }, 8, ["onRegister"]));
} }), xl = { class: "page-config" }, Al = { class: "page-config" }, Rl = (e2, l2) => {
  const a2 = e2.__vccOpts || e2;
  for (const [e3, t2] of l2) a2[e3] = t2;
  return a2;
}, Il = Rl(o({ __name: "HttpBodyParam", props: { params: { type: Object }, readOnly: { type: Boolean, default: false }, hidePage: { type: Boolean, default: false } }, emits: ["pageCheckChange"], setup(e2, { expose: l2, emit: a2 }) {
  const t2 = e2, o2 = a2, n2 = f("bodyParamRef"), { prefixCls: i2 } = se("http-body-param"), m2 = v({ page: { checked: false, pageNum: { key: "pageNum", value: void 0 }, pageSize: { key: "pageSize", value: void 0 } }, other: [] });
  function k2(e3) {
    o2("pageCheckChange", e3);
  }
  return u(() => t2.params, (e3) => {
    e3 ? (e3.page && (m2.page.checked = e3.page.checked, m2.page.pageNum.key = e3.page.pageNum.key, m2.page.pageNum.value = e3.page.pageNum.value, m2.page.pageSize.key = e3.page.pageSize.key, m2.page.pageSize.value = e3.page.pageSize.value), m2.other = e3.other || []) : (m2.page.checked = false, m2.page.pageNum.key = "pageNum", m2.page.pageNum.value = void 0, m2.page.pageSize.key = "pageSize", m2.page.pageSize.value = void 0, m2.other = []);
  }), l2({ getValue: function() {
    return { ...m2, other: n2.value?.getValue() };
  }, pageCheck: function(e3) {
    m2.page.checked = e3;
  } }), (l3, a3) => {
    const t3 = g("AInput");
    return s(), y("div", { class: h(d(i2)) }, [b(Fl, { ref_key: "bodyParamRef", ref: n2, "http-params": m2.other, "read-only": e2.readOnly }, null, 8, ["http-params", "read-only"]), (e2.readOnly && m2.page.checked || !e2.readOnly) && !e2.hidePage ? (s(), r(d($), { key: 0, style: { padding: "6px" }, title: "是否分页", tooltip: "如果开启分页，但是分页【参数值】为空，默认使用外部传入的分页", "allow-check": !e2.readOnly, "allow-collapse": !e2.readOnly, "title-check": m2.page.checked, onChecked: k2 }, { default: c(() => [q("div", xl, [a3[4] || (a3[4] = q("div", { class: "page-config-label" }, "当前页", -1)), b(t3, { disabled: e2.readOnly, prefix: "参数名称：", placeholder: "当如当前页参数名称，默认为pageNum", value: m2.page.pageNum.key, "onUpdate:value": a3[0] || (a3[0] = (e3) => m2.page.pageNum.key = e3) }, null, 8, ["disabled", "value"]), b(d(E), { prefix: "参数值：", style: { width: "100%" }, placeholder: "当如当前页参数值，默认为空", value: m2.page.pageNum.value, "onUpdate:value": a3[1] || (a3[1] = (e3) => m2.page.pageNum.value = e3) }, null, 8, ["value"])]), q("div", Al, [a3[5] || (a3[5] = q("span", { class: "page-config-label" }, "每页条数", -1)), b(t3, { disabled: e2.readOnly, prefix: "参数名称：", placeholder: "设置每页条数参数名称，默认为pageSize", value: m2.page.pageSize.key, "onUpdate:value": a3[2] || (a3[2] = (e3) => m2.page.pageSize.key = e3) }, null, 8, ["disabled", "value"]), b(d(E), { prefix: "参数值：", style: { width: "100%" }, placeholder: "设置每页条数参数值，默认为空", value: m2.page.pageSize.value, "onUpdate:value": a3[3] || (a3[3] = (e3) => m2.page.pageSize.value = e3) }, null, 8, ["value"])])]), _: 1 }, 8, ["allow-check", "allow-collapse", "title-check"])) : p("", true)], 2);
  };
} }), [["__scopeId", "data-v-fcc0f379"]]), $l = o({ __name: "HttpParams", props: { hidePage: { type: Boolean, default: false }, header: { type: String }, body: { type: String } }, setup(e2, { expose: l2 }) {
  const a2 = e2, t2 = f("headerParamRef"), o2 = f("bodyParamRef"), i2 = n(), r2 = n(), d2 = bl();
  return u(() => a2.header, (e3) => {
    if (!i2.value) if (e3) {
      if (i2.value = JSON.parse(e3), !d2.getHttpParams) return;
      i2.value?.forEach((e4) => {
        const l3 = d2.getHttpParams[e4.key];
        l3 && (e4.value = l3);
      });
    } else i2.value = [];
  }), u(() => a2.body, (e3) => {
    if (!r2.value) if (e3) {
      if (r2.value = JSON.parse(e3), !d2.getHttpParams) return;
      r2.value?.other?.forEach((e4) => {
        const l4 = d2.getHttpParams[e4.key];
        l4 && (e4.value = l4);
      });
      const l3 = d2.getHttpParams[r2.value?.page?.pageNum?.key];
      void 0 !== l3 && (r2.value.page.pageNum.value = l3);
      const a3 = d2.getHttpParams[r2.value?.page?.pageSize?.key];
      void 0 !== a3 && (r2.value.page.pageSize.value = a3);
    } else r2.value = {};
  }), l2({ getValue: function() {
    const e3 = {};
    return t2.value?.getValue()?.forEach((l3) => {
      e3[l3.key] = l3.value;
    }), o2.value?.getValue()?.other?.forEach((l3) => {
      e3[l3.key] = l3.value;
    }), o2.value?.getValue()?.page?.checked && o2.value?.getValue()?.page?.pageNum?.value && o2.value?.getValue()?.page?.pageSize?.value && (e3[r2.value?.page?.pageNum?.key] = o2.value?.getValue()?.page?.pageNum?.value, e3[r2.value?.page?.pageSize?.key] = o2.value?.getValue()?.page?.pageSize?.value), d2.setHttpParams(e3), e3;
  } }), (l3, a3) => (s(), y("div", null, [q("div", null, [a3[0] || (a3[0] = q("span", { class: "fw-bold" }, "头部参数", -1)), b(Fl, { ref_key: "headerParamRef", ref: t2, "http-params": i2.value, "read-only": true }, null, 8, ["http-params"])]), a3[1] || (a3[1] = q("span", { class: "fw-bold" }, "请求体参数", -1)), b(Il, { ref_key: "bodyParamRef", ref: o2, params: r2.value, "read-only": true, "hide-page": e2.hidePage }, null, 8, ["params", "hide-page"])]));
} }), Ol = { class: "title" }, jl = Rl(o({ __name: "ConfigWrapper", props: { iconfont: { type: String, default: void 0 }, icon: { type: String, default: void 0 }, title: { type: String, default: "" }, allowDelete: { type: Boolean, default: true }, full: { type: Boolean, default: false }, highlight: { type: Boolean, default: false }, queryMode: { type: Boolean, default: false } }, emits: ["deleteConfig", "execute"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = de().getThemeColor, { prefixCls: o2 } = se("config-wrapper"), u2 = D(), i2 = bl(), m2 = n(false);
  function f2(e3) {
    a2("deleteConfig", e3);
  }
  function v2() {
    a2("execute", u2);
  }
  return (l3, a3) => (s(), y("div", { class: h([d(o2), d(i2).getShowData && d(i2).getShowDataLevel === d(u2) ? "active" : ""]), style: k(e2.highlight ? { border: `1px solid ${d(t2)}` } : "") }, [d(i2).getShowData && d(i2).getShowDataLevel === d(u2) ? (s(), y("div", { key: 0, class: "select", style: k({ backgroundColor: d(t2) }) }, [b(d(ve), { icon: "ant-design:check-outlined", color: "#FFFFFF", size: 14 })], 4)) : p("", true), void 0 !== e2.iconfont ? (s(), r(d(ve), { key: 1, color: d(t2), icon: `iconfont:${e2.iconfont}`, size: 14 }, null, 8, ["color", "icon"])) : p("", true), void 0 !== e2.icon ? (s(), r(d(ve), { key: 2, color: d(t2), icon: e2.icon, size: 14 }, null, 8, ["color", "icon"])) : p("", true), q("div", Ol, C(e2.title), 1), e2.allowDelete && !e2.queryMode ? (s(), r(d(V), { key: 3, type: "vertical" })) : p("", true), e2.queryMode ? p("", true) : (s(), r(d(U), { key: 4, title: "删除" }, { default: c(() => [e2.allowDelete ? (s(), r(d(L), { key: 0, size: "small", type: "link", onClick: f2 }, { icon: c(() => [b(d(pe))]), _: 1 })) : p("", true)]), _: 1 })), q("div", { class: h(["config", e2.full ? "full" : ""]) }, [_(l3.$slots, "config", {}, void 0, true)], 2), b(d(U), { title: "执行" }, { default: c(() => [b(d(L), { size: "small", type: "link", style: { margin: "6px" }, onMouseenter: a3[0] || (a3[0] = (e3) => m2.value = true), onMouseleave: a3[1] || (a3[1] = (e3) => m2.value = false), onClick: v2 }, { icon: c(() => [!d(i2).getShowData || d(i2).getShowDataLevel !== d(u2) || m2.value ? (s(), r(d(me), { key: 0 })) : (s(), r(d(fe), { key: 1 }))]), _: 1 })]), _: 1 })], 6));
} }), [["__scopeId", "data-v-1359685a"]]), Bl = Rl(o({ __name: "SelectFields", props: { tableFields: { type: Object, require: true, default: void 0 }, fields: { type: Object, require: true, default: void 0 }, queryMode: { type: Boolean, default: false } }, emits: ["fieldChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n([]), i2 = n(false), { prefixCls: p2 } = se("select-fields"), m2 = M(() => a2.tableFields ? a2.tableFields?.length < 10 ? 30 * a2.tableFields?.length : 300 : 30), f2 = n(false);
  u(() => a2.tableFields, (e3) => {
    e3 && e3.length > 0 && (!function(e4) {
      o2.value = a2.tableFields?.map((l3) => ({ checked: !!e4?.find((e5) => e5.colName === l3.colName), ...l3 })) || [];
    }(a2.fields || []), i2.value = e3.length === a2.fields?.length);
  }, { immediate: true });
  let v2 = false;
  const g2 = (e3) => {
    f2.value = e3, !e3 && v2 && (t2("fieldChange", o2.value.filter((e4) => e4.checked).map((e4) => ({ colName: e4.colName, fieldName: e4.fieldName, comment: e4.comment, expression: e4.expression, dataType: e4.dataType, tableAlias: e4.tableAlias, targetType: e4.targetType }))), v2 = false);
  }, q2 = (e3) => {
    i2.value = e3.target.checked, o2.value.forEach((e4) => e4.checked = i2.value), v2 = true;
  }, _2 = (e3) => {
    const l3 = o2.value.find((l4) => l4.colName === e3.target.id);
    l3 && (l3.checked = !l3.checked, v2 = true), i2.value = !o2.value.some((e4) => !e4.checked);
  };
  return (l3, a3) => (s(), r(d(H), { trigger: ["click"], onOpenChange: g2, placement: "bottom", arrow: { pointAtCenter: true } }, { overlay: c(() => [b(d(K), null, { default: c(() => [b(d(K).Item, { disabled: "", style: { padding: "0", cursor: "default" } }, { default: c(() => [(s(), y("div", { class: h(`${d(p2)}-check-wrapper`), key: `all_check_${i2.value}` }, [b(d(z), { checked: i2.value, onChange: q2, disabled: e2.queryMode }, { default: c(() => a3[0] || (a3[0] = [Q("全选", -1)])), _: 1, __: [0] }, 8, ["checked", "disabled"])], 2)), b(d(V), { style: { margin: "4px 0" } }), b(d(ye), { style: k({ height: `${m2.value}px` }) }, { default: c(() => [(s(true), y(S, null, T(o2.value, (l4) => (s(), y("div", { key: l4.colName + l4.checked, class: h(`${d(p2)}-check-wrapper`) }, [b(d(z), { checked: l4.checked, id: l4.colName, onChange: _2, disabled: e2.queryMode }, { default: c(() => [Q(C(l4.colName + (l4.comment ? `[${l4.comment}]` : "")), 1)]), _: 2 }, 1032, ["checked", "id", "disabled"])], 2))), 128))]), _: 1 }, 8, ["style"])]), _: 1 })]), _: 1 })]), default: c(() => [b(d(L), { type: "primary" }, { default: c(() => [a3[1] || (a3[1] = Q(" 字段 ", -1)), b(d(ve), { icon: f2.value ? "ant-design:caret-up-outlined" : "ant-design:caret-down-outlined" }, null, 8, ["icon"])]), _: 1, __: [1] })]), _: 1 }));
} }), [["__scopeId", "data-v-e2824c60"]]), Dl = Rl(o({ __name: "TableFields", props: { sqlQuery: { type: Object, require: true, default: void 0 }, configMitt: { type: Object, default: void 0 }, queryMode: { type: Boolean, default: false } }, emits: ["fieldChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = P, i2 = P.Group, { prefixCls: p2 } = se("table-fields"), m2 = n([]), f2 = bl();
  function v2(e3) {
    Sl(a2.configMitt, { ...a2.sqlQuery, aggregates: [], groups: [], joins: [], customColumns: [], filters: [], orders: [], limit: void 0 }, e3);
  }
  function g2(e3) {
    t2("fieldChange", e3);
  }
  return u(() => a2.sqlQuery?.sourceTable, (e3) => {
    e3 && (e3 === f2.getTableName ? (f2.addTableFieldsMap(e3, f2.getTableFields), m2.value = f2.getTableFields) : _l(a2.sqlQuery).then((l3) => {
      f2.addTableFieldsMap(e3, l3), m2.value = l3;
    }));
  }, { immediate: true }), N(() => {
    a2.sqlQuery?.sqlQuery && a2.sqlQuery?.sourceTable && _l(a2.sqlQuery).then((e3) => {
      if (a2.sqlQuery?.sourceTable) {
        f2.addTableFieldsMap(a2.sqlQuery?.sourceTable, e3), m2.value = f2.getTableFieldsMap.get(a2.sqlQuery?.sourceTable) || [];
        const l3 = a2.sqlQuery?.fields?.filter((e4) => m2.value?.find((l4) => l4.colName === e4.colName));
        l3?.length !== a2.sqlQuery?.fields?.length && t2("fieldChange", l3);
      }
    });
  }), (l3, t3) => (s(), r(jl, { iconfont: "icon-mfish-table", title: "数据源", "allow-delete": false, onExecute: v2, "query-mode": e2.queryMode }, { config: c(() => [b(d(i2), { class: h(d(p2)), compact: "" }, { default: c(() => [b(d(o2), { value: e2.sqlQuery?.sourceTable, disabled: "" }, null, 8, ["value"]), b(Bl, w(l3.$attrs, { "table-fields": m2.value, fields: a2.sqlQuery?.fields, onFieldChange: g2, "query-mode": e2.queryMode }), null, 16, ["table-fields", "fields", "query-mode"])]), _: 1 }, 8, ["class"])]), _: 1 }, 8, ["query-mode"]));
} }), [["__scopeId", "data-v-4ff39b8d"]]), Pl = async (e2, l2) => {
  const a2 = bl(), t2 = [];
  t2.push({ value: l2.sourceTable, label: l2.sourceTable, realValue: l2.sourceTable });
  const o2 = void 0 === e2 && l2.joins?.length ? l2.joins?.length : e2 || 0;
  for (let e3 = 0; e3 < o2; e3++) l2?.joins && l2?.joins[e3].tableAlias && t2.push({ value: l2.joins[e3].tableAlias, label: l2.joins[e3].tableAlias, realValue: l2.joins[e3].table || "" });
  return t2?.map((e3) => ({ ...e3, children: a2.getTableFieldsMap.get(e3.realValue)?.map((e4) => ({ value: e4.colName, label: e4.colName + (e4.comment ? `[${e4.comment}]` : ""), realValue: { ...e4 } })) }));
}, zl = (e2, l2, a2) => {
  for (; ; ) return a2.has(l2) ? (l2.endsWith(`_${e2}`) && (l2 = l2.slice(0, Math.max(0, l2.length - `${e2}`.length - 1))), zl(++e2, `${l2}_${e2}`, a2)) : l2;
}, El = (e2) => e2?.table && e2.condition?.field?.colName && e2.condition?.joinedField?.colName, Vl = (e2) => {
  const l2 = { fields: [], table: "", tableAlias: "", condition: { field: { tableAlias: "结果集" }, operation: "=", joinedField: {} }, type: "left" };
  e2 && e2.push(l2);
}, Ul = Rl(o({ __name: "ConfigButton", props: { level: { type: Number, default: 1 }, icon: { type: String, default: void 0 }, iconfont: { type: String, default: void 0 }, title: { type: String, default: "按钮" } }, setup(e2) {
  const l2 = e2, { prefixCls: a2 } = se("config-button"), t2 = de().getThemeColor, o2 = bl(), n2 = M(() => l2.level < o2.getLevel ? 12 : 14);
  return (l3, u2) => (s(), r(d(L), w(l3.$attrs, { size: "small", shape: "round", class: d(a2), style: { "--hover-color--": d(t2) }, type: "link" }), { icon: c(() => [e2.iconfont ? (s(), r(d(ve), { key: 0, icon: `iconfont:${e2.iconfont}`, style: { "margin-right": "8px" }, size: n2.value }, null, 8, ["icon", "size"])) : (s(), r(d(ve), { key: 1, icon: e2.icon, size: n2.value }, null, 8, ["icon", "size"]))]), default: c(() => [q("span", { class: h(e2.level < d(o2).getLevel ? "show-title" : ""), style: k({ fontSize: `${n2.value}px` }) }, C(e2.title), 7)]), _: 1 }, 16, ["class", "style"]));
} }), [["__scopeId", "data-v-e48e0292"]]), Ll = { key: 0, class: "placeholder" }, Hl = { class: "condition" }, Kl = o({ __name: "TableJoins", props: { sqlQuery: { type: Object, require: true }, level: { type: Number, default: 1 }, configMitt: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["joinChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = K.Item, i2 = P, { prefixCls: m2 } = se("table-joins"), f2 = bl(), v2 = n([]), _2 = n([]), N2 = n([]), w2 = de().getThemeColor, A2 = { left: "左联", inner: "内联", right: "右联", full: "全联" }, R2 = M(() => {
    if (0 !== f2.getSourceType || a2.queryMode) return false;
    if (a2.sqlQuery && a2.sqlQuery?.joins) {
      for (const e3 of a2.sqlQuery.joins) if (!El(e3)) return false;
    }
    return Ql(a2.sqlQuery, a2.level);
  });
  u(() => a2.sqlQuery?.joins, (e3) => {
    if (!e3) return v2.value = [], void W2();
    v2.value = e3, W2();
  }, { immediate: true }), u(() => f2.getTableFieldsByName(a2.sqlQuery?.sourceTable), () => {
    a2.sqlQuery?.sourceTable && W2();
  }, { immediate: true });
  const I2 = M(() => {
    if (f2.getTableList.length > 0) {
      const e3 = [];
      return f2.getTableList.forEach((l3) => {
        e3.push({ value: l3.tableName, label: l3.tableName + (l3.tableComment ? `[${l3.tableComment}]` : "") });
      }), e3;
    }
    return [];
  }), $2 = (e3) => _2.value.length > e3 ? _2.value[e3] : [], O2 = (e3) => {
    if (a2.sqlQuery?.joins) return a2.sqlQuery?.joins[e3].table;
  }, j2 = (e3) => {
    if (!a2.sqlQuery?.joins) return [];
    const l3 = a2.sqlQuery?.joins[e3]?.condition?.field;
    if (l3?.tableAlias && l3?.fieldName) {
      const { tableAlias: e4, fieldName: a3 } = l3;
      if (e4 && a3) return [e4, a3];
    }
    return [];
  }, B2 = (e3, l3) => $2(e3).find((e4) => e4.value === l3[0]) ? l3[1] : "", D2 = (e3) => N2.value.length > e3 ? x(N2.value[e3]) : [], z2 = (e3) => {
    if (!a2.sqlQuery?.joins) return [];
    const l3 = a2.sqlQuery?.joins[e3]?.condition?.joinedField;
    return l3?.fieldName ? [l3.fieldName] : [];
  };
  function E2() {
    Vl(v2.value);
  }
  function V2(e3) {
    if (a2.sqlQuery?.joins && a2.sqlQuery?.joins.length > 0) {
      const l3 = a2.sqlQuery?.joins[e3];
      El(l3) && t2("joinChange", [...v2.value]);
    }
  }
  function L2(e3, l3) {
    const t3 = a2.sqlQuery?.joins?.map((e4) => e4.tableAlias);
    t3?.splice(e3), a2.sqlQuery?.sourceTable && t3.unshift(a2.sqlQuery?.sourceTable);
    const o3 = new Set(t3), n2 = zl(0, l3, o3);
    return a2.sqlQuery?.joins && a2.sqlQuery?.joins.length >= e3 && (v2.value[e3].tableAlias = n2), n2;
  }
  function W2() {
    const e3 = async (e4) => {
      if (!a2.sqlQuery) return;
      const l4 = await Pl(e4, a2.sqlQuery);
      l4 && _2?.value.splice(e4, 1, l4);
    }, l3 = (e4) => {
      const l4 = v2.value[e4];
      if (l4) {
        if (l4.table) {
          const a3 = f2.getTableFieldsMap.get(l4.table)?.map((e5) => ({ value: e5.colName, label: e5.colName + (e5.comment ? `[${e5.comment}]` : ""), realValue: { ...e5 } }));
          return void (a3 && N2?.value.splice(e4, 1, a3));
        }
        N2?.value.splice(e4, 1, []);
      }
    };
    for (let a3 = 0; a3 < v2?.value?.length; a3++) e3(a3).then(() => {
      const e4 = v2.value[a3].condition;
      _2.value[0][0].value === e4?.field.tableAlias && e4?.field && !_2.value[0][0].children?.some((e5) => e5.value === v2.value[a3].condition?.field.colName) && (e4.field = { tableAlias: v2.value[a3].condition?.field.tableAlias });
    }), l3(a3);
  }
  return (l3, n2) => {
    const u2 = g("AInputGroup");
    return s(), y("div", { class: h(d(m2)) }, [(s(true), y(S, null, T(e2.sqlQuery?.joins, (l4, p2) => (s(), r(jl, { iconfont: "icon-mfish-join", title: "关联", key: p2, "query-mode": e2.queryMode, onDeleteConfig: (e3) => function(e4) {
      v2?.value.splice(e4, 1), t2("joinChange", [...v2.value]);
    }(p2), onExecute: (e3) => function(e4, l5) {
      Sl(a2.configMitt, { ...a2.sqlQuery, joins: v2.value.slice(0, l5 + 1), aggregates: [], groups: [], customColumns: [], filters: [], orders: [], limit: void 0 }, e4);
    }(e3, p2) }, { config: c(() => [0 === p2 ? (s(), r(d(i2), { key: 0, class: "left-table", value: e2.sqlQuery?.sourceTable, disabled: "" }, null, 8, ["value"])) : (s(), r(d(i2), { key: 1, class: "left-table", value: l4.condition?.field.tableAlias, disabled: "" }, null, 8, ["value"])), b(d(H), { class: "condition", placement: "bottom", arrow: { pointAtCenter: true }, disabled: e2.queryMode }, { overlay: c(() => [b(d(K), { onClick: (e3) => function(e4, l5) {
      l5.type = e4.key;
    }(e3, l4), "selected-keys": [l4.type] }, { default: c(() => [(s(true), y(S, null, T(Object.keys(A2), (e3) => (s(), r(d(o2), { key: e3 }, { default: c(() => [q("div", null, [Q(C(A2[e3]) + " ", 1), b(d(ve), { icon: `iconfont:icon-mfish-${e3}-join`, color: d(w2), size: 14 }, null, 8, ["icon", "color"])])]), _: 2 }, 1024))), 128))]), _: 2 }, 1032, ["onClick", "selected-keys"])]), default: c(() => [q("a", { onClick: n2[0] || (n2[0] = F(() => {
    }, ["prevent"])) }, [Q(C(A2[l4.type]) + " ", 1), b(d(ve), { icon: `iconfont:icon-mfish-${l4.type}-join`, color: d(w2), size: 14 }, null, 8, ["icon", "color"])])]), _: 2 }, 1032, ["disabled"]), b(u2, { class: "right-table", compact: "" }, { default: c(() => {
      return [b(d(J), { disabled: e2.queryMode, "show-search": "", "allow-clear": false, class: "input-select", "option-filter-prop": "label", value: [O2(p2) || ""], options: I2.value, onChange: (e3) => function(e4, l5) {
        if (e4.length <= 0) return;
        const a3 = e4[0];
        if (l5.table === a3) return;
        l5.table = a3, l5.tableAlias = a3;
        const t4 = (e5) => {
          l5.fields = e5, l5.condition && (l5.condition.joinedField = {});
        };
        if (f2.getTableFieldsMap.has(a3)) return t4(f2.getTableFieldsMap.get(a3)), void W2();
        dl({ sourceId: bl().getSourceId, tableName: l5.table, sourceType: 0 }).then((e5) => {
          f2.addTableFieldsMap(a3, e5), t4(e5);
        }).finally(() => W2());
      }(e3, l4) }, { displayRender: c(({ selectedOptions: e3 }) => [e3[0] ? (s(), r(d(U), { key: 1, title: e3[0]?.label }, { default: c(() => [Q(C(L2(p2, e3[0]?.value)), 1)]), _: 2 }, 1032, ["title"])) : (s(), y("div", Ll, "选择关联表"))]), _: 2 }, 1032, ["disabled", "value", "options", "onChange"]), b(Bl, { "query-mode": e2.queryMode, "table-fields": (t3 = l4.table, t3 && f2.getTableFieldsMap.has(t3) ? f2.getTableFieldsMap.get(t3) : []), fields: l4.fields, onFieldChange: (e3) => function(e4, l5) {
        a2.sqlQuery?.joins && a2.sqlQuery.joins.length > 0 && (v2.value[l5].fields = e4), V2(l5);
      }(e3, p2) }, null, 8, ["query-mode", "table-fields", "fields", "onFieldChange"])];
      var t3;
    }), _: 2 }, 1024), q("span", { class: "condition", style: k({ color: d(w2) }) }, "当", 4), b(d(J), { disabled: e2.queryMode, "show-search": "", "allow-clear": false, class: "input-select", "option-filter-prop": "label", options: $2(p2), value: j2(p2), placeholder: `${e2.sqlQuery?.sourceTable}字段`, onChange: (e3, a3) => function(e4, l5, a4) {
      a4.condition && (a4.condition.field = e4[1].realValue, a4.condition.field.tableAlias = e4[0].value, V2(l5));
    }(a3, p2, l4) }, { displayRender: c(({ labels: e3 }) => [b(d(U), { title: B2(p2, e3) }, { default: c(() => [Q(C(B2(p2, e3)), 1)]), _: 2 }, 1032, ["title"])]), _: 2 }, 1032, ["disabled", "options", "value", "placeholder", "onChange"]), q("div", Hl, [b(d(ve), { icon: "iconfont:icon-mfish-equals", color: d(w2), size: 14 }, null, 8, ["color"])]), b(d(G), { disabled: e2.queryMode, "show-search": "", "allow-clear": false, class: "input-select", "option-filter-prop": "label", value: z2(p2), options: D2(p2), placeholder: `${l4.tableAlias || "关联表"}字段`, onSelect: (e3, a3) => function(e4, l5, a4) {
      a4.condition && (a4.condition.joinedField = e4.realValue, V2(l5));
    }(a3, p2, l4) }, null, 8, ["disabled", "value", "options", "placeholder", "onSelect"])]), _: 2 }, 1032, ["query-mode", "onDeleteConfig", "onExecute"]))), 128)), R2.value ? (s(), r(Ul, { key: 0, class: "config-button", title: "关联", iconfont: "icon-mfish-join", level: 0, onClick: E2 })) : p("", true)], 2);
  };
} }), Jl = Rl(Kl, [["__scopeId", "data-v-abdb59da"]]), Gl = o({ __name: "TableLimit", props: { sqlQuery: { type: Object, require: true }, configMitt: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["limitChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n(1e3);
  function i2(e3) {
    o2.value = e3;
  }
  function m2() {
    t2("limitChange", d(o2));
  }
  function f2() {
    t2("limitChange");
  }
  function v2(e3) {
    Sl(a2.configMitt, { ...a2.sqlQuery, limit: o2.value }, e3);
  }
  return u(() => a2.sqlQuery?.limit, (e3) => {
    e3 && (o2.value = e3);
  }, { immediate: true }), (l3, a3) => void 0 !== e2.sqlQuery?.limit ? (s(), r(jl, { key: 0, "query-mode": e2.queryMode, icon: "ant-design:column-height-outlined", title: "行数", onDeleteConfig: f2, onExecute: v2 }, { config: c(() => [b(d(E), { disabled: e2.queryMode, "default-value": o2.value, "addon-after": "行", step: "10", onChange: i2, onPressEnter: m2, onBlur: m2 }, null, 8, ["disabled", "default-value"])]), _: 1 }, 8, ["query-mode"])) : p("", true);
} }), Wl = [{ field: "id", label: "唯一ID", component: "Input", show: false }, { field: "name", label: "参数名称", component: "Input", dynamicRules: () => [{ required: true, validator: (e2, l2) => /^[\u4E00-\u9FA5\w]*$/.test(l2) ? Promise.resolve() : Promise.reject("错误：参数格式不正确！字符只允许中文、字符、数字、下划线!"), trigger: "blur" }] }, { field: "required", label: "是否必须", component: "RadioButtonGroup", defaultValue: 1, componentProps: { options: [{ label: "是", value: 1 }, { label: "否", value: 0 }] }, required: true }, { field: "defaultValue", label: "默认值", component: "Input" }, { field: "remark", label: "参数描述", component: "InputTextArea" }];
const Yl = Rl({ name: "ApiParamsModal", components: { BasicModal: be, BasicForm: Ce }, emits: ["addSuccess", "updateSuccess", "register", "variableChange"], setup(e2, { emit: l2 }) {
  const a2 = n(true), [t2, { resetFields: o2, setFieldsValue: u2, validate: i2 }] = _e({ name: "model_form_item", labelWidth: 100, baseColProps: { span: 24 }, schemas: Wl, showActionButtonGroup: false, autoSubmitOnEnter: true }), r2 = n(), [s2, { setModalProps: c2, closeModal: p2 }] = qe(async (e3) => {
    o2().then(), c2({ confirmLoading: false, width: "600px" }), a2.value = !!e3?.isUpdate, d(a2) && (r2.value = e3.index, u2({ ...e3.param }).then());
  }), m2 = bl(), f2 = M(() => d(a2) ? "编辑参数" : "新增参数"), { createMessage: v2 } = ce();
  return { registerModal: s2, registerForm: t2, getTitle: f2, handleSubmit: async function() {
    const e3 = (e4, l3) => {
      if (l3.some((l4) => l4.name === e4)) {
        const e5 = "错误：参数名称不允许重复!";
        throw v2.error(e5), new Error(e5);
      }
    };
    try {
      const t3 = await i2();
      if (d(a2)) {
        const a3 = [...m2.getVariables];
        a3.splice(r2.value, 1), e3(t3.name, a3), l2("updateSuccess", r2.value, t3);
      } else e3(t3.name, m2.getVariables), l2("addSuccess", t3);
      l2("variableChange", t3), p2();
    } catch (e4) {
    }
  } };
} }, [["render", function(e2, l2, a2, t2, o2, n2) {
  const u2 = g("BasicForm"), i2 = g("BasicModal");
  return s(), r(i2, w(e2.$attrs, { onRegister: t2.registerModal, title: t2.getTitle, onOk: t2.handleSubmit }), { default: c(() => [b(u2, { onRegister: t2.registerForm, onSubmit: t2.handleSubmit }, null, 8, ["onRegister", "onSubmit"])]), _: 1 }, 16, ["onRegister", "title", "onOk"]);
}]]), Xl = { key: 0 }, Zl = Rl(o({ __name: "FilterVariable", props: { value: { type: String }, queryMode: { type: Boolean, default: false } }, emits: ["variableChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = G.Option, i2 = de().getThemeColor, { prefixCls: m2 } = se("filter-variable"), [f2, { openModal: v2 }] = ke(), g2 = bl(), _2 = n();
  u(() => a2.value, (e3) => {
    _2.value = e3;
  }, { immediate: true });
  const M2 = (e3, { attrs: l3 }) => l3.vnodes;
  function N2() {
    v2(true, { isUpdate: false });
  }
  function w2(e3) {
    g2.getVariables.push(e3);
  }
  function x2(e3, l3) {
    g2.getVariables[e3] = l3;
  }
  function A2(e3) {
    t2("variableChange", e3);
  }
  function R2(e3) {
    _2.value = e3.name, t2("variableChange", e3.name);
  }
  return (l3, a3) => (s(), y(S, null, [b(d(G), { value: _2.value, "onUpdate:value": a3[0] || (a3[0] = (e3) => _2.value = e3), onChange: A2, disabled: e2.queryMode }, { dropdownRender: c(({ menuNode: e3 }) => [b(M2, { vnodes: e3 }, null, 8, ["vnodes"]), b(d(V), { style: { margin: "4px 0" } }), q("div", { style: { padding: "4px 8px", cursor: "pointer" }, onClick: N2 }, [b(d(ve), { icon: "ant-design:plus-outlined", color: d(i2) }, null, 8, ["color"]), q("span", { style: k(`color:${d(i2)};margin-left:6px`) }, "增加变量参数", 4)])]), default: c(() => [(s(true), y(S, null, T(d(g2).getVariables, (l4, a4) => (s(), r(d(o2), { label: l4.name, value: l4.name, key: a4 }, { default: c(() => [q("div", { class: h(`${d(m2)}-select-option`) }, [Q(C(l4.name) + " ", 1), q("div", null, C(l4.remark), 1), e2.queryMode || l4?.isHttpParam ? p("", true) : (s(), y("div", Xl, [b(d(ve), { icon: "ant-design:edit-outlined", color: d(i2), onClick: F((e3) => function(e4, l5) {
    v2(true, { index: e4, param: l5, isUpdate: true });
  }(a4, l4), ["stop"]) }, null, 8, ["color", "onClick"]), b(d(V), { type: "vertical" }), b(d(ve), { icon: "ant-design:delete-outlined", color: d(i2), onClick: F((e3) => function(e4) {
    g2.getVariables.splice(e4, 1), g2.getVariables.some((e5) => e5.name === _2.value) || (_2.value = "");
  }(a4), ["stop"]) }, null, 8, ["color", "onClick"])]))], 2)]), _: 2 }, 1032, ["label", "value"]))), 128))]), _: 1 }, 8, ["value", "disabled"]), b(Yl, { onRegister: d(f2), onAddSuccess: w2, onUpdateSuccess: x2, onVariableChange: R2 }, null, 8, ["onRegister"])], 64));
} }), [["__scopeId", "data-v-dff0d91d"]]), ea = o({ __name: "TableField", props: { tableFields: { type: Object }, value: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["change"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n({ dataType: "STRING" }), i2 = n([]), p2 = de().getThemeColor, m2 = n();
  function f2(e3) {
    m2.value = wl(e3);
  }
  return u(() => a2.value, (e3) => {
    e3 && (e3.tableAlias && e3.colName ? (o2.value = e3, i2.value = [e3.tableAlias, e3.colName + (e3.comment ? `[${e3.comment}]` : "")], f2(e3.dataType)) : (i2.value = [], o2.value = { dataType: "STRING" }));
  }, { immediate: true }), (l3, a3) => (s(), r(d(J), { disabled: e2.queryMode, "show-search": "", "allow-clear": false, "option-filter-prop": "label", options: e2.tableFields, value: i2.value, "onUpdate:value": a3[0] || (a3[0] = (e3) => i2.value = e3), placeholder: "选择字段", onChange: a3[1] || (a3[1] = (e3, l4) => function(e4) {
    if (e4 && 2 === e4.length) {
      const l5 = e4[0].value, a4 = e4[1].realValue;
      i2.value = [l5, e4[1].value], o2.value = a4, o2.value && (o2.value.tableAlias = l5), f2(o2.value?.dataType), t2("change", { ...o2.value });
    }
  }(l4)) }, { displayRender: c(({ labels: e3 }) => [b(d(U), { title: `${e3[0]} / ${e3[1]}` }, { default: c(() => [b(d(ve), { icon: m2.value, color: d(p2) }, null, 8, ["icon", "color"]), Q(" " + C(`${e3[0]} / ${e3[1]}`), 1)]), _: 2 }, 1032, ["title"])]), _: 1 }, 8, ["disabled", "options", "value"]));
} }), la = Rl(o({ __name: "FilterValue", props: { fieldType: { type: String, default: "STRING" }, valueType: { type: String, default: "0" }, operator: { type: String, default: "" }, tableFields: { type: Array, default: () => [] }, queryMode: { type: Boolean, default: false } }, emits: ["typeChange", "variableChange", "fieldChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = P, i2 = W.Group, m2 = W.Button, f2 = Y.ItemRest, { prefixCls: v2 } = se("filter-value"), g2 = n("0"), q2 = bl();
  function k2() {
    t2("typeChange", g2.value);
  }
  function C2(e3) {
    const l3 = q2.getVariables.find((l4) => l4.name === e3);
    l3 && t2("variableChange", e3, l3.required);
  }
  function _2(e3) {
    e3.tableAlias && e3.colName && t2("fieldChange", e3);
  }
  return u(() => a2.valueType, (e3) => {
    e3 && (g2.value = e3);
  }, { immediate: true }), (l3, a3) => (s(), y("div", { class: h(d(v2)) }, [b(d(i2), { size: "small", value: g2.value, "onUpdate:value": a3[0] || (a3[0] = (e3) => g2.value = e3), "button-style": "solid", onChange: k2, disabled: e2.queryMode }, { default: c(() => [b(d(m2), { value: "0" }, { default: c(() => a3[1] || (a3[1] = [Q("常量", -1)])), _: 1, __: [1] }), b(d(m2), { value: "1" }, { default: c(() => a3[2] || (a3[2] = [Q("变量", -1)])), _: 1, __: [2] }), b(d(m2), { value: "2" }, { default: c(() => a3[3] || (a3[3] = [Q("字段", -1)])), _: 1, __: [3] })]), _: 1 }, 8, ["value", "disabled"]), "0" === g2.value ? (s(), r(d(f2), { key: 0 }, { default: c(() => ["NUMBER" === e2.fieldType ? (s(), r(d(E), w({ key: 0 }, l3.$attrs, { disabled: e2.queryMode }), null, 16, ["disabled"])) : "DATE" === e2.fieldType && "between" !== e2.operator ? (s(), r(d(X), w({ key: 1, disabled: e2.queryMode }, l3.$attrs, { "show-time": true, "value-format": "YYYY-MM-DD HH:mm:ss" }), null, 16, ["disabled"])) : "DATE" === e2.fieldType && "between" === e2.operator ? (s(), r(d(Z), w({ key: 2, disabled: e2.queryMode }, l3.$attrs, { "show-time": true, placeholder: ["开始时间", "结束时间"], "value-format": "YYYY-MM-DD HH:mm:ss" }), null, 16, ["disabled"])) : (s(), r(d(o2), w({ key: 3 }, l3.$attrs, { disabled: e2.queryMode }), null, 16, ["disabled"]))]), _: 1 })) : p("", true), "1" === g2.value ? (s(), r(d(f2), { key: 1 }, { default: c(() => [b(Zl, { "query-mode": e2.queryMode, value: l3.$attrs.value, onVariableChange: C2 }, null, 8, ["query-mode", "value"])]), _: 1 })) : p("", true), "2" === g2.value ? (s(), r(d(f2), { key: 2 }, { default: c(() => [b(ea, { "query-mode": e2.queryMode, "table-fields": e2.tableFields, value: l3.$attrs.value, onChange: _2 }, null, 8, ["query-mode", "table-fields", "value"])]), _: 1 })) : p("", true)], 2));
} }), [["__scopeId", "data-v-1b7847a8"]]), aa = o({ __name: "FilterModal", props: { queryMode: { type: Boolean, default: false } }, emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = Y.Item, o2 = v({ field: void 0, operator: "", value: void 0 }), u2 = n(), i2 = n([]), m2 = v({ field: { dataType: "STRING" }, type: "1", valueType: "0", required: true }), f2 = n([]), g2 = n(true), y2 = n(), h2 = { STRING: [{ label: "是", value: "eq" }, { label: "不是", value: "ne" }, { label: "包含", value: "like" }, { label: "不包含", value: "notLike" }, { label: "以开始", value: "likeLeft" }, { label: "以结束", value: "likeRight" }, { label: "为空", value: "isNull" }, { label: "不为空", value: "isNotNull" }], NUMBER: [{ label: "等于", value: "eq" }, { label: "不等于", value: "ne" }, { label: "大于", value: "gt" }, { label: "大于等于", value: "ge" }, { label: "小于", value: "lt" }, { label: "小于等于", value: "le" }, { label: "包含", value: "like" }, { label: "不包含", value: "notLike" }, { label: "以开始", value: "likeLeft" }, { label: "以结束", value: "likeRight" }, { label: "为空", value: "isNull" }, { label: "不为空", value: "isNotNull" }], DATE: [{ label: "晚于", value: "gt" }, { label: "晚于等于", value: "ge" }, { label: "早于", value: "lt" }, { label: "早于等于", value: "le" }, { label: "为空", value: "isNull" }, { label: "不为空", value: "isNotNull" }] }, [q2, { setModalProps: k2, closeModal: C2 }] = qe(async (e3) => {
    if (k2({ confirmLoading: false, width: "600px" }), Pl(void 0, e3.sqlQuery).then((e4) => {
      i2.value = e4;
    }), e3.isUpdate) return m2.field = e3.field, m2.valueType = e3.valueType, m2.required = e3.required, M2(m2.field?.dataType), y2.value = e3.index, o2.field = [e3.field.tableAlias, e3.field.colName], o2.operator = e3.operator, e3.operator === vl.between ? o2.value = e3.value ? e3.value.split(",") : [] : o2.value = e3.value ?? "", e3.operator === vl.isNull || e3.operator === vl.isNotNull ? (g2.value = false, o2.value = "") : g2.value = true, void ("2" === e3.valueType && e3.value && (o2.value = JSON.parse(e3.value)));
    o2.field = [], o2.value = void 0, o2.operator = "", y2.value = void 0, m2.field = {}, m2.valueType = "0", m2.required = true;
  });
  function _2(e3) {
    if (e3.tableAlias && e3.colName) {
      const l3 = e3.tableAlias;
      "0" === m2.valueType && e3.dataType !== m2.field?.dataType && (o2.value = void 0), o2.field = [l3, e3.colName], m2.field = e3, m2.field && (m2.field.tableAlias = l3), M2(m2.field?.dataType), f2.value.some((e4) => o2.operator === e4.value) || (o2.operator = "");
    }
  }
  function M2(e3) {
    e3 && (f2.value = h2[e3]);
  }
  function Q2(e3) {
    e3 === vl.isNull || e3 === vl.isNotNull ? (g2.value = false, o2.value = "") : g2.value = true, "DATE" === m2.field?.dataType && (e3 === vl.between ? o2.value = o2.value ? `${o2.value}`.split(",") : [] : o2.value = o2.value ? `${o2.value}`.split(",")[0] : "");
  }
  async function S2() {
    try {
      const e3 = await u2.value?.validateFields();
      C2(), a2("submit", y2.value, { ...m2, name: `${m2.field?.colName} ${o2.operator ? f2.value.find((e4) => e4.value === o2.operator)?.label : ""}${g2.value ? ` ${void 0 === o2.value ? "''" : "0" === m2.valueType ? "" === o2.value ? "''" : o2.value : "2" === m2.valueType ? o2.value?.colName : `#{${o2.value}}`}` : ""}`, operator: e3?.operator, value: void 0 === e3?.value ? "" : "2" === m2.valueType ? JSON.stringify(e3.value) : `${e3.value}` });
    } catch (e3) {
    }
  }
  function T2(e3) {
    o2.value = void 0, m2.valueType = e3;
  }
  function N2(e3, l3) {
    o2.value = e3, m2.required = l3;
  }
  function F2(e3) {
    o2.value = e3;
  }
  return (l3, a3) => (s(), r(d(be), w(l3.$attrs, { onRegister: d(q2), title: "设置过滤条件", onOk: S2 }), { default: c(() => [b(d(Y), { ref_key: "formRef", ref: u2, model: o2, "label-col": { span: 6 }, "wrapper-col": { span: 16 } }, { default: c(() => [b(d(t2), { label: "字段", name: "field", rules: [{ required: true, message: "请选择字段！" }] }, { default: c(() => [b(ea, { "query-mode": e2.queryMode, "table-fields": i2.value, value: m2.field, onChange: _2 }, null, 8, ["query-mode", "table-fields", "value"])]), _: 1 }), b(d(t2), { label: "条件", name: "operator", rules: [{ required: true, message: "请选择条件！" }] }, { default: c(() => [b(d(G), { disabled: e2.queryMode, "show-search": "", "allow-clear": false, class: "input-select", "option-filter-prop": "label", value: o2.operator, "onUpdate:value": a3[0] || (a3[0] = (e3) => o2.operator = e3), options: f2.value, placeholder: "选择条件", onSelect: Q2 }, null, 8, ["disabled", "value", "options"])]), _: 1 }), g2.value ? (s(), r(d(t2), { key: 0, label: "值", name: "value", rules: [{ required: "STRING" !== m2.field?.dataType, message: "请选择值！" }] }, { default: c(() => [b(la, { "query-mode": e2.queryMode, placeholder: "输入值", value: o2.value, "onUpdate:value": a3[1] || (a3[1] = (e3) => o2.value = e3), "value-type": m2.valueType, "field-type": m2.field?.dataType, operator: o2.operator, "table-fields": i2.value, onTypeChange: T2, onVariableChange: N2, onFieldChange: F2 }, null, 8, ["query-mode", "value", "value-type", "field-type", "operator", "table-fields"])]), _: 1 }, 8, ["rules"])) : p("", true)]), _: 1 }, 8, ["model"])]), _: 1 }, 16, ["onRegister"]));
} }), ta = o({ __name: "TableFilter", props: { sqlQuery: { type: Object }, level: { type: Number, default: 1 }, configMitt: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["filterChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n([]), i2 = M(() => void 0 === a2.sqlQuery?.filters && Ql(a2.sqlQuery, a2.level) && !a2.queryMode);
  u(() => a2.sqlQuery?.filters, (e3) => {
    o2.value = e3 ? [...e3] : [];
  }, { immediate: true });
  const m2 = de().getThemeColor, f2 = n([{ name: "添加", icon: "icon-mfish-left-bracket", color: m2, value: { type: "0", name: "(", value: "(" } }, { name: "添加", icon: "icon-mfish-right-bracket", color: m2, value: { type: "0", name: ")", value: ")" } }]), v2 = { type: "0", slot: true, hideClose: true, value: "and" }, [g2, { openModal: h2 }] = ke();
  function q2() {
    t2("filterChange");
  }
  function k2() {
    t2("filterChange", []);
  }
  function C2() {
    h2(true, { sqlQuery: a2.sqlQuery, isUpdate: false });
  }
  function _2(e3, l3) {
    "0" !== l3.type && h2(true, { index: e3, ...l3, sqlQuery: a2.sqlQuery, isUpdate: true });
  }
  function Q2(e3, l3) {
    void 0 === e3 ? o2.value ? (o2.value?.findIndex((e4) => "1" === e4.type) >= 0 && o2.value.push(v2), o2.value.push(l3)) : o2.value = [l3, v2] : o2.value && (o2.value[e3] = l3), t2("filterChange", o2.value ? [...o2.value] : []);
  }
  function S2(e3, l3) {
    if ("0" === l3.type) return;
    let a3 = false;
    const t3 = (e4) => {
      const l4 = o2.value[e4];
      return !!l4 && ("0" === l4.type && ("and" === l4.value || "or" === l4.value) && (o2.value.splice(e4, 1), true));
    };
    for (let l4 = e3 - 1; l4 >= 0; l4--) if (t3(l4)) return void (a3 = true);
    if (!a3) {
      for (let l4 = e3; l4 < o2.value.length; l4++) if (t3(l4)) return;
    }
  }
  function T2(e3) {
    t2("filterChange", [...e3]);
  }
  function N2(e3) {
    Sl(a2.configMitt, { ...a2.sqlQuery, filters: o2.value, aggregates: [], groups: [], customColumns: [], orders: [], limit: void 0 }, e3);
  }
  return (l3, a3) => (s(), y("div", null, [void 0 !== e2.sqlQuery?.filters ? (s(), r(jl, { key: 0, "query-mode": e2.queryMode, icon: "ant-design:filter-outlined", title: "过滤", onDeleteConfig: q2, full: true, onExecute: N2 }, { config: c(() => [b(d(he), { "query-mode": e2.queryMode, items: o2.value, menus: f2.value, "add-title": "添加过滤条件", onAddBlock: C2, onEditBlock: _2, onCloseBlock: S2, onDragChange: T2 }, { tag: c(({ index: l4, element: a4 }) => [b(d(ee), { disabled: e2.queryMode, style: { "margin-right": "8px" }, checked: a4?.value, "checked-children": "且", "un-checked-children": "或", "checked-value": "and", "un-checked-value": "or", size: "small", onChange: (e3) => function(e4, l5) {
    o2.value && o2.value?.length > l5 && (o2.value[l5].value = e4, setTimeout(() => {
      o2.value && t2("filterChange", [...o2.value]);
    }, 300));
  }(e3, l4) }, null, 8, ["disabled", "checked", "onChange"])]), _: 1 }, 8, ["query-mode", "items", "menus"])]), _: 1 }, 8, ["query-mode"])) : p("", true), i2.value ? (s(), r(Ul, { key: 1, class: "config-button", title: "过滤", icon: "ant-design:filter-outlined", level: 0, onClick: F(k2, ["prevent"]) })) : p("", true), b(aa, { "query-mode": e2.queryMode, onRegister: d(g2), onSubmit: Q2 }, null, 8, ["query-mode", "onRegister"])]));
} }), oa = o({ __name: "AggregateModal", props: { queryMode: { type: Boolean, default: false } }, emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = Y.Item, o2 = v({ field: void 0, aggFunc: "" }), u2 = n(), i2 = n([]), m2 = v({ field: { dataType: "STRING" } }), f2 = Object.keys(gl).map((e3) => ({ value: e3, label: gl[e3] })), g2 = n(true), y2 = n(), [h2, { setModalProps: q2, closeModal: k2 }] = qe(async (e3) => {
    if (q2({ confirmLoading: false, width: "600px" }), Pl(void 0, e3.sqlQuery).then((e4) => {
      for (let l3 = 0; l3 < e4.length; l3++) {
        const a3 = e4[l3];
        a3.children ? (a3.children = a3.children?.filter((e5) => "NUMBER" === e5.realValue.dataType), 0 === a3.children?.length && e4.splice(l3--, 1)) : e4.splice(l3--, 1);
      }
      i2.value = e4;
    }), e3.isUpdate) return o2.field = [e3.field.tableAlias, e3.field.colName], o2.aggFunc = e3.aggFunc, m2.field = e3.field, g2.value = gl[o2.aggFunc] !== gl.count, void (y2.value = e3.index);
    o2.field = [], o2.aggFunc = "", y2.value = void 0, g2.value = true, m2.field = {};
  });
  function C2(e3) {
    e3.tableAlias && e3.colName && (o2.field = [e3.tableAlias, e3.colName], m2.field = e3);
  }
  function _2(e3) {
    g2.value = gl[e3] !== gl.count;
  }
  async function M2() {
    try {
      const e3 = await u2.value?.validateFields();
      k2(), a2("submit", y2.value, { ...m2, name: gl[o2.aggFunc] + (gl[o2.aggFunc] === gl.count ? "" : `(${m2.field?.colName})`), aggFunc: e3.aggFunc });
    } catch (e3) {
    }
  }
  return (l3, a3) => (s(), r(d(be), w(l3.$attrs, { onRegister: d(h2), title: "选择聚合字段", onOk: M2 }), { default: c(() => [b(d(Y), { ref_key: "formRef", ref: u2, model: o2, "label-col": { span: 6 }, "wrapper-col": { span: 16 } }, { default: c(() => [b(d(t2), { label: "聚合方式", name: "aggFunc", rules: [{ required: true, message: "请选择聚合方式！" }] }, { default: c(() => [b(d(G), { disabled: e2.queryMode, "show-search": "", "allow-clear": false, "option-filter-prop": "label", value: o2.aggFunc, "onUpdate:value": a3[0] || (a3[0] = (e3) => o2.aggFunc = e3), options: d(f2), placeholder: "选择聚合方式", onSelect: _2 }, null, 8, ["disabled", "value", "options"])]), _: 1 }), g2.value ? (s(), r(d(t2), { key: 0, label: "字段", name: "field", rules: [{ required: true, message: "请选择字段！" }] }, { default: c(() => [b(ea, { "query-mode": e2.queryMode, "table-fields": i2.value, value: m2.field, onChange: C2 }, null, 8, ["query-mode", "table-fields", "value"])]), _: 1 })) : p("", true)]), _: 1 }, 8, ["model"])]), _: 1 }, 16, ["onRegister"]));
} }), na = o({ __name: "GroupModal", props: { queryMode: { type: Boolean, default: false } }, emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = Y.Item, o2 = v({ field: void 0 }), u2 = v({ field: { dataType: "STRING" } }), i2 = n(), p2 = n([]), m2 = n(), [f2, { setModalProps: g2, closeModal: y2 }] = qe(async (e3) => {
    if (g2({ confirmLoading: false, width: "600px" }), Pl(void 0, e3.sqlQuery).then((e4) => {
      p2.value = e4;
    }), e3.isUpdate) return o2.field = [e3.field.tableAlias, e3.field.colName], u2.field = e3.field, void (m2.value = e3.index);
    o2.field = [], m2.value = void 0, u2.field = {};
  });
  function h2(e3) {
    e3.tableAlias && e3.colName && (o2.field = [e3.tableAlias, e3.colName], u2.field = e3);
  }
  async function q2() {
    try {
      await i2.value?.validateFields(), y2(), a2("submit", m2.value, { ...u2, name: u2.field?.colName });
    } catch (e3) {
    }
  }
  return (l3, a3) => (s(), r(d(be), w(l3.$attrs, { onRegister: d(f2), title: "选择分组字段", onOk: q2 }), { default: c(() => [b(d(Y), { ref_key: "formRef", ref: i2, model: o2, "label-col": { span: 6 }, "wrapper-col": { span: 16 } }, { default: c(() => [b(d(t2), { label: "字段", name: "field", rules: [{ required: true, message: "请选择字段！" }] }, { default: c(() => [b(ea, { "query-mode": e2.queryMode, "table-fields": p2.value, value: u2.field, onChange: h2 }, null, 8, ["query-mode", "table-fields", "value"])]), _: 1 })]), _: 1 }, 8, ["model"])]), _: 1 }, 16, ["onRegister"]));
} }), ua = Rl(o({ __name: "TableAggregate", props: { sqlQuery: { type: Object }, configMitt: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["aggregateChange", "groupChange", "deleteAggregate"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = de().getThemeColor, { prefixCls: i2 } = se("table-aggregate"), m2 = n(), f2 = n(), [v2, { openModal: g2 }] = ke(), [k2, { openModal: C2 }] = ke();
  async function _2() {
    t2("deleteAggregate");
  }
  function M2() {
    g2(true, { sqlQuery: a2.sqlQuery, isUpdate: false });
  }
  function Q2(e3, l3) {
    void 0 === e3 ? m2.value ? m2.value.push(l3) : m2.value = [l3] : m2.value && (m2.value[e3] = l3), t2("aggregateChange", m2.value ? [...m2.value] : []);
  }
  function S2(e3, l3) {
    g2(true, { index: e3, ...l3, sqlQuery: a2.sqlQuery, isUpdate: true });
  }
  function T2(e3) {
    t2("aggregateChange", [...e3]);
  }
  function N2() {
    C2(true, { sqlQuery: a2.sqlQuery, isUpdate: false });
  }
  function w2(e3, l3) {
    void 0 === e3 ? f2.value ? f2.value.push(l3) : f2.value = [l3] : f2.value && (f2.value[e3] = l3), t2("groupChange", f2.value ? [...f2.value] : []);
  }
  function F2(e3, l3) {
    C2(true, { index: e3, ...l3, sqlQuery: a2.sqlQuery, isUpdate: true });
  }
  function x2(e3) {
    t2("groupChange", [...e3]);
  }
  function A2(e3) {
    Sl(a2.configMitt, { ...a2.sqlQuery, aggregates: m2.value, groups: f2.value, orders: [], limit: void 0 }, e3);
  }
  return u(() => a2.sqlQuery?.aggregates, (e3) => {
    m2.value = e3 ? [...e3] : [];
  }, { immediate: true }), u(() => a2.sqlQuery?.groups, (e3) => {
    f2.value = e3 ? [...e3] : [];
  }, { immediate: true }), (l3, a3) => (s(), y("div", { class: h(d(i2)) }, [void 0 !== e2.sqlQuery?.aggregates ? (s(), r(jl, { key: 0, "query-mode": e2.queryMode, iconfont: "icon-mfish-sum", title: "聚合", onDeleteConfig: _2, onExecute: A2, full: true }, { config: c(() => [b(d(he), { "query-mode": e2.queryMode, items: m2.value, "add-title": "添加聚合指标", onAddBlock: M2, onEditBlock: S2, onDragChange: T2 }, null, 8, ["query-mode", "items"]), b(d(ve), { class: "groupIcon", icon: "ant-design:group-outlined", color: d(o2), style: { "font-size": "14px" } }, null, 8, ["color"]), a3[0] || (a3[0] = q("div", { class: "group" }, "分组", -1)), b(d(he), { "query-mode": e2.queryMode, items: f2.value, "add-title": "添加分组指标", onAddBlock: N2, onEditBlock: F2, onDragChange: x2 }, null, 8, ["query-mode", "items"])]), _: 1 }, 8, ["query-mode"])) : p("", true), b(oa, { "query-mode": e2.queryMode, onRegister: d(v2), onSubmit: Q2 }, null, 8, ["query-mode", "onRegister"]), b(na, { "query-mode": e2.queryMode, onRegister: d(k2), onSubmit: w2 }, null, 8, ["query-mode", "onRegister"])], 2));
} }), [["__scopeId", "data-v-3519b7ea"]]), ia = "其他", ra = o({ __name: "OrderModal", emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = Y.Item, o2 = v({ field: void 0 }), u2 = v({ field: { dataType: "STRING" }, order: "ASC" }), i2 = n(), p2 = n([]), m2 = n(), f2 = bl(), [g2, { setModalProps: y2, closeModal: h2 }] = qe(async (e3) => {
    if (y2({ confirmLoading: false, width: "600px" }), Ml(e3.sqlQuery) ? sl({ sourceId: f2.getSourceId, sourceType: f2.getSourceType, sqlQuery: e3.sqlQuery }).then((e4) => {
      p2.value = [{ value: ia, label: ia, realValue: ia, children: e4.map((e5) => ({ value: e5.colName, label: e5.colName + (e5.comment ? `[${e5.comment}]` : ""), realValue: { ...e5 } })) }];
    }) : p2.value = await Pl(void 0, e3.sqlQuery), e3.isUpdate) return o2.field = [e3.field.tableAlias, e3.field.colName], u2.field = e3.field, void (m2.value = e3.index);
    o2.field = [], m2.value = void 0, u2.field = {};
  });
  function q2(e3) {
    e3.tableAlias && e3.colName && (o2.field = [e3.tableAlias, e3.colName], u2.field = e3);
  }
  async function k2() {
    try {
      await i2.value?.validateFields(), h2(), u2.field.tableAlias === ia && (u2.field.tableAlias = ""), a2("submit", m2.value, { ...u2, name: u2.field?.colName });
    } catch (e3) {
    }
  }
  return (e3, l3) => (s(), r(d(be), w(e3.$attrs, { onRegister: d(g2), title: "选择排序字段", onOk: k2 }), { default: c(() => [b(d(Y), { ref_key: "formRef", ref: i2, model: o2, "label-col": { span: 6 }, "wrapper-col": { span: 16 } }, { default: c(() => [b(d(t2), { label: "字段", name: "field", rules: [{ required: true, message: "请选择字段！" }] }, { default: c(() => [b(ea, { "table-fields": p2.value, value: u2.field, onChange: q2 }, null, 8, ["table-fields", "value"])]), _: 1 })]), _: 1 }, 8, ["model"])]), _: 1 }, 16, ["onRegister"]));
} }), sa = o({ __name: "TableOrder", props: { sqlQuery: { type: Object, default: void 0 }, configMitt: { type: Object, default: void 0 }, queryMode: { type: Boolean, default: false } }, emits: ["orderChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n([]), [i2, { openModal: m2 }] = ke();
  function f2() {
    m2(true, { sqlQuery: a2.sqlQuery, isUpdate: false });
  }
  function v2(e3, l3) {
    l3.order = "ASC" === l3.order ? "DESC" : "ASC", q2(e3, l3);
  }
  function g2(e3) {
    t2("orderChange", [...e3]);
  }
  function h2() {
    t2("orderChange");
  }
  function q2(e3, l3) {
    void 0 === e3 ? o2.value ? o2.value.push(l3) : o2.value = [l3] : o2.value && (o2.value[e3] = l3), t2("orderChange", o2.value ? [...o2.value] : []);
  }
  function k2(e3) {
    Sl(a2.configMitt, { ...a2.sqlQuery, orders: o2.value, limit: void 0 }, e3);
  }
  return u(() => a2.sqlQuery?.orders, (e3) => {
    o2.value = e3 || [];
  }, { immediate: true }), (l3, a3) => (s(), y("div", null, [void 0 !== e2.sqlQuery?.orders ? (s(), r(jl, { key: 0, "query-mode": e2.queryMode, icon: "ant-design:sort-ascending-outlined", title: "排序", onDeleteConfig: h2, full: true, onExecute: k2 }, { config: c(() => [b(d(he), { "query-mode": e2.queryMode, items: o2.value, "add-title": "添加排序指标", onAddBlock: f2, onEditBlock: v2, onDragChange: g2 }, { tagIcon: c(({ element: e3 }) => [b(d(ve), { style: { "font-weight": "bold", "font-size": "20px" }, icon: "ASC" === e3.order ? "ant-design:sort-descending-outlined" : "ant-design:sort-ascending-outlined" }, null, 8, ["icon"])]), _: 1 }, 8, ["query-mode", "items"])]), _: 1 }, 8, ["query-mode"])) : p("", true), b(ra, { onRegister: d(i2), onSubmit: q2 }, null, 8, ["onRegister"])]));
} }), da = o({ __name: "FieldColModal", emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = Y.Item, o2 = v({ field: void 0 }), u2 = n(), i2 = n(), p2 = n([]), m2 = n(), [f2, { setModalProps: g2, closeModal: y2 }] = qe(async (e3) => {
    if (g2({ confirmLoading: false, width: "600px" }), Pl(void 0, e3.sqlQuery).then((e4) => {
      p2.value = e4;
    }), e3.isUpdate) {
      const l3 = e3.field.value;
      return o2.field = [l3.tableAlias, l3.colName], u2.value = l3, void (m2.value = e3.index);
    }
    o2.field = [], m2.value = void 0, u2.value = {};
  });
  function h2(e3) {
    e3.tableAlias && e3.colName && (o2.field = [e3.tableAlias, e3.colName], u2.value = e3);
  }
  async function q2() {
    try {
      await i2.value?.validateFields(), y2(), a2("submit", m2.value, { type: yl.field, value: u2.value, name: u2.value?.colName });
    } catch (e3) {
    }
  }
  return (e3, l3) => (s(), r(d(be), w(e3.$attrs, { onRegister: d(f2), title: "选择字段", onOk: q2 }), { default: c(() => [b(d(Y), { ref_key: "formRef", ref: i2, model: o2, "label-col": { span: 6 }, "wrapper-col": { span: 16 } }, { default: c(() => [b(d(t2), { label: "字段", name: "field", rules: [{ required: true, message: "请选择字段！" }] }, { default: c(() => [b(ea, { "table-fields": p2.value, value: u2.value, onChange: h2 }, null, 8, ["table-fields", "value"])]), _: 1 })]), _: 1 }, 8, ["model"])]), _: 1 }, 16, ["onRegister"]));
} }), ca = ["onClick"], pa = ["onClick"], ma = Rl(o({ __name: "FormulaManagement", props: { isShow: { type: Boolean, default: false }, curKey: { type: String, default: "" } }, emits: ["select"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = le.Item, i2 = ae.Item, m2 = n([]), { prefixCls: f2 } = se("formula-management"), v2 = n(null), g2 = de().getThemeColor, _2 = n([]), N2 = n(false), w2 = n([]), F2 = n(), x2 = n(0.4), R2 = n([]), I2 = n(), $2 = M(() => {
    if ("" === F2.value?.parentId) return;
    const e3 = F2.value?.formulaInfo;
    if (!e3) return;
    let l3;
    try {
      l3 = e3?.paramDesc ? JSON.parse(e3?.paramDesc) : [];
    } catch {
      l3 = e3?.paramDesc ? [e3?.paramDesc] : [];
    }
    return { description: e3.description, paramDesc: l3, returnDesc: e3.returnDesc };
  });
  function O2(e3, l3) {
    const a3 = [];
    l3 ? a3.push({ icon: l3.icon, title: l3.name, key: l3.key }) : m2.value = e3 ? e3.children : [], e3 && a3.push({ icon: e3.icon, title: e3.name, key: e3.key }), I2.value = a3, F2.value = e3, t2("select", e3);
  }
  function j2(e3, l3) {
    O2(l3.node.dataRef, l3.node?.parent?.node);
  }
  function B2(e3) {
    if (!e3) return O2(), void (_2.value = []);
    _2.value = [e3];
    const l3 = e3.split(",");
    if (l3 && 2 === l3.length) return v2.value?.setExpandedKeys([l3[0]]), void O2(v2.value?.getSelectedNode(e3), v2.value?.getSelectedNode(l3[0]));
    O2(v2.value?.getSelectedNode(e3));
  }
  u(() => a2.isShow, (e3) => {
    e3 && setTimeout(() => {
      B2(a2.curKey);
    }, 200);
  }, { immediate: true });
  const D2 = M(() => N2.value ? d(w2) : d(m2));
  return A(async () => {
    const e3 = await Ue();
    !function e4(l3, a3) {
      for (const t3 of a3) t3.children && t3.children.length > 0 && e4(t3, t3.children), l3 ? (t3.icon = "ant-design:function-outlined", t3.key = `${l3.id},${t3.id}`) : (t3.icon = "ant-design:star-outlined", t3.key = t3.id), t3.title = t3.name + (t3?.formulaInfo ? `(${t3?.formulaInfo?.enName})` : "");
    }(void 0, e3), R2.value = e3;
  }), (e3, l3) => (s(), r(d(Qe), { "default-size": x2.value, min: 0.1, max: 0.5, class: h(d(f2)) }, { 1: c(() => [b(d(Me), { title: "", toolbar: "", search: "", ref_key: "asyncTreeRef", ref: v2, "tree-wrapper-class-name": "h-[calc(100%-35px)] overflow-auto", "selected-keys": _2.value, "onUpdate:selectedKeys": l3[0] || (l3[0] = (e4) => _2.value = e4), "tree-data": R2.value || [], onSelect: j2 }, null, 8, ["selected-keys", "tree-data"])]), 2: c(() => [q("div", { class: h(`${d(f2)}-right h-full pt-2`) }, [b(d(le), { separator: ">", class: "breadcrumb" }, { default: c(() => [(s(true), y(S, null, T(I2.value, (e4, l4) => (s(), r(d(o2), { key: l4 }, { default: c(() => [b(d(ve), { icon: e4.icon }, null, 8, ["icon"]), q("a", { onClick: (l5) => B2(e4.key), class: "fw-bold text-decoration-none" }, C(e4.title), 9, ca)]), _: 2 }, 1024))), 128))]), _: 1 }), F2.value && "" === F2.value.parentId ? (s(), r(d(ye), { key: 0 }, { default: c(() => [b(d(te), { class: "ml-6" }, { default: c(() => [(s(true), y(S, null, T(D2.value, (e4, l4) => (s(), r(d(oe), { span: 22, key: l4, class: h(`${d(f2)}-card`) }, { default: c(() => [q("div", { class: h(`${d(f2)}-card-item`), onClick: (l5) => B2(e4.key) }, [q("div", { class: h(`${d(f2)}-card-item-info`) }, [b(d(U), { title: e4.formulaInfo?.cnName }, { default: c(() => [q("span", { style: k(`color: ${d(g2)};font-weight: bold`) }, [b(d(ve), { icon: "ant-design:function-outlined", color: d(g2) }, null, 8, ["color"]), Q(" " + C(e4.formulaInfo?.cnName) + " (" + C(e4.formulaInfo?.enName) + ") ", 1)], 4)]), _: 2 }, 1032, ["title"]), b(d(U), { title: e4.formulaInfo?.description }, { default: c(() => [q("span", null, C(e4.formulaInfo?.description), 1)]), _: 2 }, 1032, ["title"])], 2)], 10, pa)]), _: 2 }, 1032, ["class"]))), 128))]), _: 1 })]), _: 1 })) : p("", true), F2.value && F2.value.formulaInfo ? (s(), r(d(ye), { key: 1 }, { default: c(() => [b(d(ae), { class: "pt-3 pr-2", column: 1, bordered: true }, { default: c(() => [b(d(i2), { label: "描述" }, { default: c(() => [Q(C($2.value?.description), 1)]), _: 1 }), b(d(i2), { label: "参数" }, { default: c(() => [(s(true), y(S, null, T($2.value?.paramDesc, (e4, l4) => (s(), y("div", { key: l4 }, C(e4), 1))), 128))]), _: 1 }), b(d(i2), { label: "结果" }, { default: c(() => [Q(C($2.value?.returnDesc), 1)]), _: 1 })]), _: 1 })]), _: 1 })) : p("", true)], 2)]), _: 1 }, 8, ["default-size", "class"]));
} }), [["__scopeId", "data-v-5fa7a95b"]]), fa = { key: 0, class: "content" }, va = { key: 1, class: "content placeholder" }, ga = Rl(o({ __name: "FormulaSelect", props: { formulaKey: { type: String, default: "" }, queryMode: { type: Boolean, default: false } }, emits: ["formulaChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = M(() => de().getDarkMode.value === Se.DARK), { prefixCls: i2 } = se("select-formula"), p2 = n(false);
  let m2;
  const { createMessage: f2 } = ce(), v2 = bl(), g2 = n(), k2 = (e3) => {
    p2.value = e3;
  };
  function _2() {
    p2.value = false, g2.value = void 0, m2 = void 0, t2("formulaChange", g2.value);
  }
  function S2() {
    m2 ? (p2.value = false, g2.value?.key !== m2.key && (g2.value = { key: m2.key, ...m2.formulaInfo }, t2("formulaChange", g2.value))) : f2.error("请选择公式");
  }
  function T2(e3) {
    e3?.formulaInfo && (m2 = x(e3));
  }
  return u(() => a2.formulaKey, (e3) => {
    e3 && (g2.value = v2.getFormula(e3));
  }, { immediate: true }), (l3, a3) => (s(), r(d(H), { disabled: e2.queryMode, trigger: ["click"], open: p2.value, onOpenChange: k2, placement: "bottom", arrow: { pointAtCenter: true }, "overlay-style": { width: "500px" } }, { overlay: c(() => [b(d(K), null, { default: c(() => [b(d(K).Item, { disabled: "", style: { padding: "0", cursor: "default" } }, { default: c(() => [b(ma, { style: { height: "350px" }, "is-show": p2.value, "cur-key": g2.value?.key, onSelect: T2 }, null, 8, ["is-show", "cur-key"]), q("div", { class: h(`${d(i2)}-ok-button`) }, [b(d(L), { class: "mr-2", onClick: _2 }, { default: c(() => a3[0] || (a3[0] = [Q("清空", -1)])), _: 1, __: [0] }), b(d(L), { type: "primary", onClick: S2 }, { default: c(() => a3[1] || (a3[1] = [Q("确定", -1)])), _: 1, __: [1] })], 2)]), _: 1 })]), _: 1 })]), default: c(() => [b(d(L), { class: h(`${d(i2)}-drop-button`) }, { default: c(() => [g2.value?.cnName ? (s(), y("span", fa, C(g2.value?.cnName), 1)) : (s(), y("span", va, "选择公式")), b(d(ve), { size: 12, icon: p2.value ? "ant-design:up-outlined" : "ant-design:down-outlined", color: o2.value ? "rgba(255, 255, 255, 0.25)" : "rgba(0, 0, 0, 0.25)" }, null, 8, ["icon", "color"])]), _: 1 }, 8, ["class"])]), _: 1 }, 8, ["disabled", "open"]));
} }), [["__scopeId", "data-v-983d37a1"]]), ya = "displayName", ha = { config: { type: Object, default: () => ({ type: yl.param, value: "" }) }, comType: { type: String, default: "string" }, paramType: { type: String, default: "string" }, paramValue: { type: String, default: "" }, showRadio: { type: Boolean, default: true }, sqlQuery: { type: Object }, index: { type: Number, default: 0 }, queryMode: { type: Boolean, default: false } }, ba = (e2) => {
  if (!e2) return { type: yl.formula, value: null };
  const l2 = (e2?.targetParam ? JSON.parse(e2.targetParam) : []).map((e3) => e3.paramType.startsWith("list") ? { type: yl.param, value: [{ type: yl.param, value: "" }] } : { type: yl.param, value: "" });
  return { type: yl.formula, value: { key: e2.key, cnName: e2.cnName, enName: e2.enName, targetObject: e2.targetObject, param: l2 } };
}, qa = Rl(o({ __name: "FormulaCompact", props: ha, emits: ["typeChange", "formulaSelect", "inputChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, { prefixCls: o2 } = se("formula-compact"), i2 = W.Group, m2 = W.Button, f2 = n("string"), v2 = n("string"), g2 = n(), k2 = n(yl.param), C2 = n(), _2 = n([]), M2 = n(), Q2 = n(false), S2 = n([]), T2 = n();
  function N2(e3) {
    t2("formulaSelect", e3 || "");
  }
  function w2() {
    t2("inputChange", void 0 === g2.value ? "" : g2.value);
  }
  function F2(e3) {
    e3.tableAlias && e3.colName && (M2.value = e3, t2("inputChange", { ...e3, [ya]: "colName" }));
  }
  function x2(e3, l3) {
    t2("inputChange", l3.realValue || "");
  }
  function A2(e3) {
    t2("typeChange", e3.target.value);
  }
  return u(() => a2.config, (e3) => {
    e3 && (k2.value = e3.type, e3.type === yl.formula ? C2.value = e3.value?.key : g2.value = e3.value);
  }, { immediate: true }), u(() => a2.paramType, (e3) => {
    if (e3) if (e3.startsWith("list[")) {
      const l3 = /list\[(?<value>.*?)\]/u;
      v2.value = e3.replace(l3, "$<value>");
    } else v2.value = e3;
  }, { immediate: true }), u(() => a2.comType, (e3) => {
    e3 && (f2.value = e3);
  }, { immediate: true }), u(() => k2.value, (e3) => {
    if (e3 === yl.param && "list" === f2.value) {
      const e4 = /@\{(?<value>.*?)\}/u, l3 = a2.paramValue?.replace(e4, "$<value>");
      Q2.value = "fieldName" === l3, Q2.value && a2.sqlQuery ? Pl(void 0, a2.sqlQuery).then((e5) => {
        _2.value = e5, M2.value = a2.config.value || {};
      }) : Le(l3).then((e5) => {
        if (S2.value = [], e5 && e5.value) {
          const l4 = e5[ya];
          e5.value.forEach((e6) => {
            const a3 = e6[l4];
            S2.value.push({ label: a3, value: a3, realValue: { ...e6, [ya]: l4 } });
          }), a2.config?.value && (T2.value = a2.config.value[a2.config.value[ya]]);
        }
      });
    }
  }, { immediate: true }), (e3, l3) => (s(), y("div", { class: h(d(o2)) }, [a2.showRadio ? (s(), r(d(i2), { key: 0, disabled: a2.queryMode, class: "radio-group", value: k2.value, "onUpdate:value": l3[0] || (l3[0] = (e4) => k2.value = e4), "button-style": "solid", onChange: A2 }, { default: c(() => ["number" === v2.value ? (s(), r(d(m2), { key: 0, value: d(yl).param }, { default: c(() => [b(d(U), { placement: "left", title: "数字" }, { default: c(() => [b(d(ve), { icon: "ant-design:field-number-outlined" })]), _: 1 })]), _: 1 }, 8, ["value"])) : (s(), r(d(m2), { key: 1, value: d(yl).param }, { default: c(() => [b(d(U), { placement: "left", title: "字符" }, { default: c(() => [b(d(ve), { icon: "ant-design:field-string-outlined" })]), _: 1 })]), _: 1 }, 8, ["value"])), b(d(m2), { value: d(yl).formula }, { default: c(() => [b(d(U), { placement: "left", title: "公式" }, { default: c(() => [b(d(ve), { icon: "ant-design:function-outlined" })]), _: 1 })]), _: 1 }, 8, ["value"])]), _: 1 }, 8, ["disabled", "value"])) : p("", true), q("div", { class: h(a2.showRadio ? "formula-select" : "formula-select-show") }, [k2.value === d(yl).param && "string" === f2.value ? (s(), r(d(P), { key: 0, disabled: a2.queryMode, value: g2.value, "onUpdate:value": l3[1] || (l3[1] = (e4) => g2.value = e4), class: "input-com", placeholder: "请输入字符常量", onChange: w2 }, null, 8, ["disabled", "value"])) : k2.value === d(yl).param && "number" === f2.value ? (s(), r(d(E), { key: 1, disabled: a2.queryMode, value: g2.value, "onUpdate:value": l3[2] || (l3[2] = (e4) => g2.value = e4), class: "input-com", placeholder: "请输入数字常量", onChange: w2 }, null, 8, ["disabled", "value"])) : k2.value === d(yl).param && "list" === f2.value && Q2.value ? (s(), r(ea, { key: 2, "query-mode": a2.queryMode, class: "select-com", "table-fields": _2.value, value: M2.value, onChange: F2 }, null, 8, ["query-mode", "table-fields", "value"])) : k2.value !== d(yl).param || "list" !== f2.value || Q2.value ? (s(), r(ga, { key: 4, "query-mode": a2.queryMode, "formula-key": C2.value, onFormulaChange: N2 }, null, 8, ["query-mode", "formula-key"])) : (s(), r(d(G), { key: 3, disabled: a2.queryMode, class: "select-com", value: T2.value, "onUpdate:value": l3[3] || (l3[3] = (e4) => T2.value = e4), options: S2.value, placeholder: "请选择参数", onSelect: x2 }, null, 8, ["disabled", "value", "options"]))], 2)], 2));
} }), [["__scopeId", "data-v-a24bef98"]]), ka = { style: { "margin-top": "6px", display: "flex", "justify-content": "flex-end" } }, Ca = o({ __name: "FormulaAround", emits: ["submit"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = n([]), o2 = n(), u2 = n(false);
  let i2;
  const { createMessage: p2 } = ce(), m2 = (e3) => {
    u2.value = e3;
  };
  function f2(e3) {
    if (!e3) return i2 = e3, void (o2.value = void 0);
    i2 = ba(e3);
    const l3 = e3?.targetParam ? JSON.parse(e3.targetParam) : [];
    t2.value = [];
    for (const [e4, a3] of l3.entries()) t2.value.push({ label: a3.name, value: e4 });
    o2.value = t2.value.length > 0 ? 0 : void 0;
  }
  function v2() {
    u2.value = false;
  }
  function g2() {
    i2 && void 0 !== o2.value ? a2("submit", { formulaConfig: i2, paramIndex: o2.value }) : p2.error("请选择公式");
  }
  return (e3, l3) => (s(), r(d(H), { trigger: ["click"], open: u2.value, placement: "bottom", arrow: { pointAtCenter: true }, onOpenChange: m2 }, { overlay: c(() => [b(d(K), null, { default: c(() => [b(d(K).Item, { disabled: "", style: { padding: "0", cursor: "default" } }, { default: c(() => [b(d(ne), { title: "上层公式设置", bordered: false, style: { width: "240px" } }, { default: c(() => [b(ga, { onFormulaChange: f2 }), b(d(G), { style: { width: "100%", "margin-top": "6px" }, placeholder: "选择作为哪个参数", class: "select-com", value: o2.value, "onUpdate:value": l3[0] || (l3[0] = (e4) => o2.value = e4), options: t2.value }, null, 8, ["value", "options"]), q("div", ka, [b(d(L), { size: "small", onClick: v2 }, { default: c(() => l3[1] || (l3[1] = [Q(" 取消", -1)])), _: 1, __: [1] }), b(d(L), { size: "small", type: "primary", style: { "margin-left": "6px" }, onClick: g2 }, { default: c(() => l3[2] || (l3[2] = [Q(" 确定", -1)])), _: 1, __: [2] })])]), _: 1 })]), _: 1 })]), _: 1 })]), default: c(() => [b(d(L), { style: { "margin-top": "-6px" }, size: "small", type: "link" }, { icon: c(() => [b(d(U), { placement: "left", title: "添加外层公式，当前层作为公式参数" }, { default: c(() => [b(d(ve), { icon: "ant-design:node-collapse-outlined" })]), _: 1 })]), _: 1 })]), _: 1 }, 8, ["open"]));
} }), _a = { class: "formula" }, Ma = { class: "title" }, Qa = { key: 0, class: "add" }, Sa = Rl(o({ __name: "FormulaConfig", props: ha, emits: ["formulaChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n(), i2 = n(), { prefixCls: m2 } = se("formula-config"), f2 = bl(), k2 = n(), _2 = v({ type: yl.param, value: "" }), M2 = n(0), N2 = (e3) => e3.startsWith("list"), w2 = (e3) => k2?.value?.value?.param && Array.isArray(k2?.value.value.param[e3].value) ? k2?.value.value.param[e3].value : [0];
  function F2(e3) {
    _2.value = e3, t2("formulaChange", _2);
  }
  function x2(e3) {
    o2.value = e3?.targetParam ? JSON.parse(e3.targetParam) : [];
    try {
      i2.value = e3?.paramDesc ? JSON.parse(e3?.paramDesc) : [];
    } catch {
      i2.value = e3?.paramDesc ? [e3?.paramDesc] : [];
    }
  }
  function A2(e3) {
    x2(e3), k2.value = ba(e3), M2.value++, t2("formulaChange", k2.value);
  }
  function R2(e3) {
    o2.value = [], t2("formulaChange", { type: e3, value: "" });
  }
  function I2(e3) {
    e3.formulaConfig.value.param[e3.paramIndex] = k2.value;
    const l3 = JSON.parse(JSON.stringify(e3.formulaConfig));
    x2(l3), t2("formulaChange", l3, true);
  }
  return u(() => a2.config, (e3) => {
    e3 && (k2.value = e3, function() {
      if (k2.value?.type === yl.formula) {
        const e4 = f2.getFormula(k2.value?.value?.key);
        e4 && x2(e4);
      }
    }());
  }, { immediate: true }), (e3, l3) => {
    const n2 = g("FormulaConfig", true);
    return s(), y("div", { class: h(d(m2)) }, [q("div", _a, [b(qa, { "query-mode": a2.queryMode, class: "main", index: a2.index, "com-type": a2.comType, "param-type": a2.paramType, "param-value": a2.paramValue, config: k2.value, "sql-query": a2.sqlQuery, "show-radio": a2.showRadio, onInputChange: F2, onFormulaSelect: A2, onTypeChange: R2 }, null, 8, ["query-mode", "index", "com-type", "param-type", "param-value", "config", "sql-query", "show-radio"]), k2.value?.type !== d(yl).formula || a2.queryMode ? p("", true) : (s(), r(Ca, { key: 0, onSubmit: I2 }))]), (s(true), y(S, null, T(o2.value, (e4, o3) => (s(), y("div", { key: `${M2.value}${o3}` }, [(s(true), y(S, null, T(w2(o3), (l4, u2) => (s(), y("div", { class: "param", key: u2 }, [b(d(ve), { class: "icon", icon: "ant-design:arrow-up-outlined" }), q("span", Ma, [b(d(U), { placement: "left", title: i2.value ? i2.value[o3] : "" }, { default: c(() => [Q(C(e4.name), 1)]), _: 2 }, 1032, ["title"])]), b(n2, { "query-mode": a2.queryMode, index: u2, "com-type": e4.comType, "param-type": e4.paramType, "param-value": e4.value, config: N2(e4.paramType) && k2.value?.value?.param && k2.value?.value?.param[o3]?.value ? k2.value?.value?.param[o3]?.value[u2] : k2.value?.value?.param[o3], "sql-query": a2.sqlQuery, onFormulaChange: (l5) => function(e5, l6, a3, o4) {
      k2.value?.type === yl.formula && k2.value.value && k2.value.value.param && (N2(a3) ? k2.value.value.param[l6].value ? k2.value.value.param[l6].value[o4] = e5 : k2.value.value.param[l6].value = [e5] : k2.value.value.param[l6] = e5), t2("formulaChange", k2.value);
    }(l5, o3, e4.paramType, u2) }, null, 8, ["query-mode", "index", "com-type", "param-type", "param-value", "config", "sql-query", "onFormulaChange"]), u2 > 0 ? (s(), r(d(L), { key: 0, size: "small", type: "link", onClick: (e5) => function(e6, l5) {
      k2.value?.type === yl.formula && k2.value.value && k2.value.value.param && (k2.value.value.param[e6].value.splice(l5, 1), M2.value++, t2("formulaChange", k2.value));
    }(o3, u2) }, { icon: c(() => [b(d(ve), { icon: "ant-design:delete-outlined" })]), _: 2 }, 1032, ["onClick"])) : p("", true)]))), 128)), N2(e4.paramType) ? (s(), y("div", Qa, [b(d(L), { type: "primary", onClick: (e5) => function(e6) {
      k2.value && (k2.value.value.param[e6].value ? k2.value.value.param[e6].value.push({ type: yl.param, value: "" }) : k2.value.value.param[e6].value = [{ type: yl.param, value: "" }]);
    }(o3) }, { default: c(() => l3[0] || (l3[0] = [Q("增加参数", -1)])), _: 2, __: [0] }, 1032, ["onClick"])])) : p("", true)]))), 128))], 2);
  };
} }), [["__scopeId", "data-v-cbde54bb"]]), Ta = o({ __name: "ParamsModal", emits: ["register", "submit"], setup(e2, { emit: l2 }) {
  const a2 = l2, [t2, { resetFields: o2, setFieldsValue: u2, validate: i2, resetSchema: p2, getFieldsValue: m2 }] = _e({ name: "model_form_item", labelWidth: 180, baseColProps: { span: 24 }, showActionButtonGroup: false, autoSubmitOnEnter: true }), f2 = bl(), v2 = n(), [g2, { setModalProps: y2, closeModal: h2 }] = qe(async (e3) => {
    y2({ confirmLoading: false, width: "1000px", canFullscreen: false }), v2.value = e3.level;
    const l3 = m2(), a3 = f2.getVariables.filter((l4) => l4.name && e3.params.has(l4.name) || l4.isHttpParam).map((e4) => ({ field: e4.name, label: e4.name, component: "Input", required: e4.required || false, helpMessage: e4.remark || "", defaultValue: l3[e4.name] || f2.getHttpParams && f2.getHttpParams[e4.name] || e4.defaultValue }));
    p2(a3).then(() => {
      o2().then(), u2(a3.reduce((e4, l4) => (l4 && (e4[l4.field] = l4.defaultValue), e4), {})).then();
    });
  });
  async function q2() {
    try {
      const e3 = await i2();
      a2("submit", e3, v2.value), h2();
    } catch (e3) {
    }
  }
  return (e3, l3) => (s(), r(d(be), w(e3.$attrs, { onRegister: d(g2), title: "输入参数值", onOk: q2 }), { default: c(() => [b(d(Ce), { onRegister: d(t2), onSubmit: q2 }, null, 8, ["onRegister"])]), _: 1 }, 16, ["onRegister"]));
} }), Na = o({ __name: "FormulaTest", props: { open: { type: Boolean, default: false }, curQuery: { type: Object }, curParams: { type: Object } }, emits: ["close"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = de().getThemeColor, i2 = bl(), m2 = n(false);
  u(() => a2.open, (e3) => {
    m2.value = e3, e3 && f2();
  });
  const f2 = Te((e3) => {
    let l3 = 1, t3 = 10;
    e3 && (l3 = e3.current, t3 = e3.pageSize), rl({ sourceId: i2.getSourceId, sourceType: i2.getSourceType, sqlQuery: a2.curQuery || {}, params: a2.curParams }, { pageNum: l3, pageSize: t3 }).then((e4) => {
      const l4 = Object.keys(e4.headers).map((e5) => ({ title: e5, dataIndex: e5 }));
      g2(l4), h2(e4.table.list), q2({ total: e4.table.total, pageSize: e4.table.pageSize, current: e4.table.pageNum });
    }).catch(() => {
      g2([]);
    });
  }, 200), [v2, { setColumns: g2, setTableData: h2, setPagination: q2 }] = O({ bordered: true, showIndexColumn: false, isCanResizeParent: true, canResize: true, onChange: f2 }), _2 = () => {
    m2.value = false, t2("close", true);
  };
  return (e3, l3) => (s(), r(d(ue), { title: "测试结果", placement: "bottom", open: m2.value, onClose: _2, height: 450 }, { default: c(() => [b(d(j), { onRegister: d(v2) }, { bodyCell: c(({ column: e4, record: l4 }) => [e4?.key === d(kl) ? (s(), y("div", { key: 0, style: k({ color: d(o2) }) }, C(l4[d(kl)]), 5)) : p("", true)]), _: 1 }, 8, ["onRegister"])]), _: 1 }, 8, ["open"]));
} }), wa = o({ __name: "FormulaColModal", props: { queryMode: { type: Boolean, default: false } }, emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = l2, t2 = n(), o2 = n(), u2 = n(), i2 = v({ type: yl.formula, value: null });
  let m2;
  const f2 = n(0), g2 = bl(), [h2, { openModal: q2 }] = ke(), k2 = n(), C2 = n(), _2 = n(false), M2 = (e3) => {
    let l3 = "";
    return Array.isArray(e3.value) ? (e3.value.forEach((e4) => {
      l3 += `${M2(e4)},`;
    }), l3.endsWith(",") ? l3 = l3.slice(0, Math.max(0, l3.lastIndexOf(","))) : l3) : e3.type === yl.formula && e3.value ? (l3 = `${e3.value.cnName}(`, e3.value.param.forEach((e4) => {
      l3 += `${M2(e4)},`;
    }), l3.endsWith(",") && (l3 = l3.slice(0, Math.max(0, l3.lastIndexOf(",")))), l3 += ")", l3) : (e3.type === yl.param && (l3 += e3.value instanceof Object ? e3.value[e3.value[ya]] : e3.value), l3);
  }, [T2, { setModalProps: N2, closeModal: F2 }] = qe(async (e3) => {
    N2({ confirmLoading: false, width: "800px", minHeight: 500, maskClosable: false, keyboard: false }), t2.value = e3.index, o2.value = e3.isUpdate, await g2.setFormulaMap(), m2 = e3.sqlQuery, e3.isUpdate ? (i2.value = JSON.parse(JSON.stringify(e3.formulaConfig.value)), u2.value = M2(i2)) : (i2.value = null, u2.value = ""), f2.value++;
  });
  async function x2() {
    try {
      if (!i2.value) return;
      F2(), a2("submit", o2.value, t2.value, { ...i2, name: u2.value });
    } catch (e3) {
    }
  }
  function A2(e3, l3) {
    i2.value = e3.value, e3 && (u2.value = M2(e3)), l3 && f2.value++;
  }
  function R2() {
    k2.value = { schema: m2.schema, sourceTable: m2.sourceTable, joins: m2.joins, sqlQuery: m2?.sqlQuery, customColumns: [{ name: kl, expressions: [{ type: yl.formula, value: i2.value }] }] };
    const e3 = Tl(k2.value || {});
    e3 && e3.size > 0 ? q2(true, { params: e3, level: 1 }) : I2({});
  }
  function I2(e3) {
    C2.value = e3, _2.value = true;
  }
  return (l3, a3) => (s(), y(S, null, [b(d(be), w(l3.$attrs, { onRegister: d(T2), title: "公式配置", onOk: x2 }), { centerFooter: c(() => [b(d(L), { onClick: R2, type: "primary", danger: "" }, { default: c(() => a3[1] || (a3[1] = [Q("测试", -1)])), _: 1, __: [1] })]), default: c(() => [u2.value ? (s(), r(d(ie), { key: 0, class: "mb-2", message: u2.value, type: "info", "show-icon": "" }, { icon: c(() => [b(d(ve), { icon: "ant-design:function-outlined" })]), _: 1 }, 8, ["message"])) : p("", true), (s(), r(Sa, { "query-mode": e2.queryMode, key: f2.value, "sql-query": d(m2), "show-radio": false, config: i2, onFormulaChange: A2 }, null, 8, ["query-mode", "sql-query", "config"])), b(Na, { "cur-query": k2.value, "cur-params": C2.value, open: _2.value, onClose: a3[0] || (a3[0] = () => _2.value = false) }, null, 8, ["cur-query", "cur-params", "open"])]), _: 1 }, 16, ["onRegister"]), b(Ta, { onRegister: d(h2), onSubmit: I2 }, null, 8, ["onRegister"])], 64));
} }), Fa = Rl(o({ __name: "CustomColModal", props: { sqlQuery: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["submit", "register"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n(true), u2 = de().getThemeColor, { prefixCls: i2 } = se("col-modal"), p2 = n([]), m2 = v({ formula: { key: "formula", name: "公式", icon: "icon-mfish-sum", color: "#cd201f" }, add: { key: "add", name: "加号", icon: "icon-mfish-add", color: u2 }, subtract: { key: "subtract", name: "减号", icon: "icon-mfish-subtract", color: u2, slot: true }, multiply: { key: "multiply", name: "乘号", icon: "icon-mfish-multiply", color: u2, slot: true }, divide: { key: "divide", name: "除号", icon: "icon-mfish-divide", color: u2, slot: true }, leftBracket: { key: "leftBracket", name: "左括号", icon: "icon-mfish-left-bracket", color: u2, slot: true }, rightBracket: { key: "rightBracket", name: "右括号", icon: "icon-mfish-right-bracket", color: u2, slot: true } }), f2 = v({ formula: { type: yl.formula, value: "" }, add: { type: yl.operator, name: "add", value: "+", slot: true }, subtract: { type: yl.operator, name: "subtract", value: "-", slot: true }, multiply: { type: yl.operator, name: "multiply", value: "*", slot: true }, divide: { type: yl.operator, name: "divide", value: "/", slot: true }, leftBracket: { type: yl.operator, name: "leftBracket", value: "(", slot: true }, rightBracket: { type: yl.operator, name: "rightBracket", value: ")", slot: true } }), k2 = [{ field: "customCol", label: "自定义列", component: "Input", slot: "customCol" }, { field: "name", label: "名称", component: "Input", componentProps: { disabled: a2.queryMode, placeholder: "请输入名称", maxlength: 30, showCount: true }, required: true }], [C2, { resetFields: _2, setFieldsValue: M2, validate: N2 }] = _e({ name: "model_form_item", labelWidth: 100, baseColProps: { span: 24 }, schemas: k2, showActionButtonGroup: false, autoSubmitOnEnter: true }), [F2, { openModal: x2 }] = ke(), [A2, { openModal: I2 }] = ke(), $2 = n();
  const [O2, { setModalProps: j2, closeModal: B2 }] = qe(async (e3) => {
    _2().then(), j2({ confirmLoading: false, width: "600px", maskClosable: false }), o2.value = !!e3?.isUpdate, d(o2) ? ($2.value = e3.index, M2({ ...e3.customCol }).then(), p2.value = JSON.parse(JSON.stringify(e3.customCol.expressions))) : ($2.value = void 0, p2.value = []);
  }), [D2, { openModal: P2 }] = ke(), z2 = n(), E2 = n(), V2 = n(false);
  async function L2() {
    try {
      const e3 = await N2();
      t2("submit", $2.value, { name: e3.name, expressions: p2.value }), B2();
    } catch (e3) {
    }
  }
  function H2(e3, l3, t3) {
    l3.type !== yl.operator ? (t3(false, l3), I2(true, { index: e3, sqlQuery: { ...a2.sqlQuery }, isUpdate: false })) : t3(true, l3);
  }
  function K2() {
    x2(true, { sqlQuery: { ...a2.sqlQuery }, isUpdate: false });
  }
  function J2(e3, l3) {
    l3.type === yl.field && x2(true, { index: e3, field: l3, sqlQuery: { ...a2.sqlQuery }, isUpdate: true }), l3.type === yl.formula && I2(true, { index: e3, formulaConfig: l3, sqlQuery: { ...a2.sqlQuery }, isUpdate: true });
  }
  function G2(e3, l3) {
    void 0 === e3 ? p2.value ? p2.value.push(l3) : p2.value = [l3] : p2.value && (p2.value[e3] = l3);
  }
  function W2(e3, l3, a3) {
    e3 ? p2.value && (p2.value[l3] = a3) : p2.value ? l3 ? p2.value.splice(l3, 0, a3) : p2.value.push(a3) : p2.value = [a3];
  }
  function Y2() {
    z2.value = { schema: a2.sqlQuery?.schema, sourceTable: a2.sqlQuery?.sourceTable, joins: a2.sqlQuery?.joins, sqlQuery: a2.sqlQuery?.sqlQuery, customColumns: [{ name: kl, expressions: p2.value }] };
    const e3 = Tl(z2.value || {});
    e3 && e3.size > 0 ? P2(true, { params: e3, level: 1 }) : X2({});
  }
  function X2(e3) {
    E2.value = e3, V2.value = true;
  }
  return (l3, t3) => {
    const o3 = g("AButton");
    return s(), y(S, null, [b(d(be), w(l3.$attrs, { onRegister: d(O2), title: "自定义列配置", onOk: L2 }), { centerFooter: c(() => [b(o3, { onClick: Y2, type: "primary", danger: "" }, { default: c(() => t3[1] || (t3[1] = [Q("测试", -1)])), _: 1, __: [1] })]), default: c(() => [b(d(Ce), { onRegister: d(C2), onSubmit: L2 }, { customCol: c(() => [b(d(he), { "query-mode": e2.queryMode, "add-title": "添加字段", items: p2.value, onBlockBuild: H2, onAddBlock: K2, onEditBlock: J2 }, R({ tag: c(({ element: e3 }) => [q("div", { class: h(`${d(i2)}-slot-tag`) }, [b(d(ge), { icon: m2[e3.name].icon, color: d(u2) }, null, 8, ["icon", "color"])], 2)]), _: 2 }, [e2.queryMode ? void 0 : { name: "headerBar", fn: c(({ headerCallBack: e3 }) => [(s(true), y(S, null, T(m2, (l4, t4) => (s(), r(d(U), { key: t4, title: l4.name }, { default: c(() => [b(d(re), { style: { cursor: "pointer" }, color: l4.color, draggable: "true", onClick: (t5) => function(e4, l5) {
      l5.type !== yl.operator ? I2(true, { index: void 0, sqlQuery: a2.sqlQuery, isUpdate: false }) : e4(l5);
    }(e3, f2[l4.key]), onDragstart: (e4) => function(e5, l5) {
      e5.dataTransfer.setData("Text", JSON.stringify(f2[l5.key])), e5.stopPropagation();
    }(e4, l4) }, { icon: c(() => [b(d(ge), { icon: l4.icon }, null, 8, ["icon"])]), _: 2 }, 1032, ["color", "onClick", "onDragstart"])]), _: 2 }, 1032, ["title"]))), 128))]), key: "0" }]), 1032, ["query-mode", "items"])]), _: 1 }, 8, ["onRegister"]), b(da, { onRegister: d(F2), onSubmit: G2 }, null, 8, ["onRegister"]), b(wa, { "query-mode": e2.queryMode, onRegister: d(A2), onSubmit: W2 }, null, 8, ["query-mode", "onRegister"]), b(Na, { "cur-query": z2.value, "cur-params": E2.value, open: V2.value, onClose: t3[0] || (t3[0] = () => V2.value = false) }, null, 8, ["cur-query", "cur-params", "open"])]), _: 1 }, 16, ["onRegister"]), b(Ta, { onRegister: d(D2), onSubmit: X2 }, null, 8, ["onRegister"])], 64);
  };
} }), [["__scopeId", "data-v-ffce7698"]]), xa = o({ __name: "TableCustomCol", props: { sqlQuery: { type: Object }, level: { type: Number, default: 1 }, configMitt: { type: Object }, queryMode: { type: Boolean, default: false } }, emits: ["customColChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, o2 = n([]);
  function i2() {
    t2("customColChange");
  }
  const [m2, { openModal: f2 }] = ke(), v2 = M(() => void 0 === a2.sqlQuery?.customColumns && Ql(a2.sqlQuery, a2.level) && !a2.queryMode);
  function g2() {
    f2(true, { sqlQuery: a2.sqlQuery, isUpdate: false });
  }
  function h2(e3, l3) {
    f2(true, { index: e3, customCol: { ...l3 }, sqlQuery: a2.sqlQuery, isUpdate: true });
  }
  function q2(e3) {
    t2("customColChange", [...e3]);
  }
  function k2() {
    t2("customColChange", []);
  }
  function C2(e3) {
    Sl(a2.configMitt, { ...a2.sqlQuery, customColumns: o2.value, aggregates: [], groups: [], orders: [], limit: void 0 }, e3);
  }
  function _2(e3, l3) {
    void 0 === e3 ? o2.value ? o2.value.push(l3) : o2.value = [l3] : o2.value && (o2.value[e3] = l3), t2("customColChange", o2.value ? [...o2.value] : []);
  }
  return u(() => a2.sqlQuery?.customColumns, (e3) => {
    o2.value = e3 ? [...e3] : [];
  }, { immediate: true }), (l3, a3) => (s(), y("div", null, [void 0 !== e2.sqlQuery?.customColumns ? (s(), r(jl, { key: 0, "query-mode": e2.queryMode, icon: "ant-design:insert-row-right-outlined", title: "自定义列", onDeleteConfig: i2, onExecute: C2, full: true }, { config: c(() => [b(d(he), { "query-mode": e2.queryMode, items: o2.value, "add-title": "添加自定义列", onAddBlock: g2, onEditBlock: h2, onDragChange: q2 }, null, 8, ["query-mode", "items"])]), _: 1 }, 8, ["query-mode"])) : p("", true), v2.value ? (s(), r(Ul, { key: 1, class: "config-button", title: "自定义列", icon: "ant-design:insert-row-right-outlined", level: 0, onClick: F(k2, ["prevent"]) })) : p("", true), b(Fa, { "query-mode": e2.queryMode, onRegister: d(m2), "sql-query": e2.sqlQuery, onSubmit: _2 }, null, 8, ["query-mode", "onRegister", "sql-query"])]));
} }), Aa = { class: "btn-bar" }, Ra = Rl(o({ __name: "ApiConfig", props: { configKey: { type: Number, default: 0, require: true }, sqlQuery: { type: Object, require: true, default: void 0 }, level: { type: Number, default: 1 }, configMitt: { type: Object, default: void 0 }, queryMode: { type: Boolean, default: false } }, emits: ["configChange"], setup(e2, { emit: l2 }) {
  const a2 = e2, t2 = l2, { sqlQuery: o2 } = I(a2), { prefixCls: u2 } = se("api-config"), i2 = de().getThemeColor, c2 = n(), m2 = n(), { focused: f2 } = Ne(c2), { focused: v2 } = Ne(m2), C2 = bl(), _2 = n(false), Q2 = M(() => {
    if (0 !== C2.getSourceType || a2.queryMode) return false;
    if (a2.sqlQuery && a2.sqlQuery?.joins) {
      for (const e3 of a2.sqlQuery.joins) if (!El(e3)) return false;
    }
    return true;
  }), S2 = M(() => (void 0 === a2.sqlQuery?.filters || Ql(a2.sqlQuery, a2.level)) && !a2.queryMode), T2 = M(() => (void 0 === a2.sqlQuery?.customColumns || Ql(a2.sqlQuery, a2.level)) && !a2.queryMode), N2 = M(() => (void 0 === a2.sqlQuery?.aggregates || Ql(a2.sqlQuery, a2.level)) && !a2.queryMode), w2 = M(() => void 0 === a2.sqlQuery?.orders && !a2.queryMode), F2 = M(() => void 0 === a2.sqlQuery?.limit && !a2.queryMode);
  function x2(e3) {
    t2("configChange", { ...a2.sqlQuery, fields: e3 }), C2.setFieldsChange(a2.level);
  }
  function A2(e3) {
    const l3 = { ...a2.sqlQuery, joins: e3 };
    E2(l3) || (t2("configChange", l3), C2.setFieldsChange(a2.level));
  }
  function R2(e3) {
    const l3 = { ...a2.sqlQuery, filters: e3 };
    E2(l3) || t2("configChange", l3);
  }
  function $2(e3) {
    const l3 = { ...a2.sqlQuery, customColumns: e3 };
    E2(l3) || (t2("configChange", l3), C2.setFieldsChange(a2.level));
  }
  function O2(e3) {
    const l3 = { ...a2.sqlQuery, aggregates: e3 };
    E2(l3) || (t2("configChange", l3), C2.setFieldsChange(a2.level));
  }
  function j2(e3) {
    const l3 = { ...a2.sqlQuery, groups: e3 };
    E2(l3) || (t2("configChange", l3), C2.setFieldsChange(a2.level));
  }
  function B2() {
    const e3 = { ...a2.sqlQuery, aggregates: void 0, groups: void 0 };
    E2(e3) || (t2("configChange", e3), C2.setFieldsChange(a2.level));
  }
  function D2(e3) {
    const l3 = { ...a2.sqlQuery, orders: e3 };
    E2(l3) || t2("configChange", l3);
  }
  function P2(e3) {
    const l3 = { ...a2.sqlQuery, limit: e3 };
    E2(l3) || t2("configChange", l3);
  }
  function z2(e3) {
    const l3 = { ...a2.sqlQuery, sqlQuery: e3 };
    E2(l3) || t2("configChange", l3);
  }
  function E2(e3) {
    return !(!e3?.sqlQuery || !e3?.joins || 0 !== e3.joins.length || void 0 !== e3.filters || void 0 !== e3.aggregates || void 0 !== e3.customColumns || void 0 !== e3.groups || void 0 !== e3.orders || void 0 !== e3.limit) && (t2("configChange", JSON.parse(JSON.stringify(e3.sqlQuery)), true), true);
  }
  async function V2() {
    const e3 = { sourceTable: "MFISH_ALIAS_" + a2.level, joins: [], fields: [], sqlQuery: { ...a2.sqlQuery } };
    return e3.fields = await _l(e3), e3;
  }
  async function U2() {
    if (Ql(a2.sqlQuery, a2.level)) {
      const e3 = await V2();
      return e3.joins = [], Vl(e3.joins), void t2("configChange", e3, true);
    }
    o2?.value?.joins && Vl(o2?.value?.joins);
  }
  function L2() {
    J2(["filters"]);
  }
  function H2() {
    J2(["customColumns"]);
  }
  function K2() {
    J2(["aggregates", "groups"]);
  }
  async function J2(e3) {
    let l3;
    const o3 = (l4, a3) => {
      e3.forEach((e4) => l4[e4] = []), t2("configChange", l4, a3);
    };
    if (Ql(a2.sqlQuery, a2.level)) return l3 = await V2(), void o3(l3, true);
    l3 = { ...a2.sqlQuery }, o3(l3, false);
  }
  function G2() {
    o2?.value?.orders || t2("configChange", { ...a2.sqlQuery, orders: [] });
  }
  function W2() {
    o2?.value?.limit || t2("configChange", { ...a2.sqlQuery, limit: 1e3 });
  }
  function Y2() {
    a2.configMitt?.emit(Cl.QUERY_SQL, a2.sqlQuery), v2.value = false;
  }
  function X2() {
    Sl(a2.configMitt, a2.sqlQuery, a2.level), f2.value = false;
  }
  return (l3, a3) => {
    const t3 = g("ApiConfig", true);
    return s(), y("div", { class: h([d(u2), e2.level < d(C2).getLevel ? "inner" : "", d(C2).getShowData && d(C2).getShowDataLevel === e2.level ? "active" : ""]) }, [d(C2).getShowData && d(C2).getShowDataLevel === e2.level ? (s(), y("div", { key: 0, class: "select", style: k({ backgroundColor: d(i2) }) }, [b(d(ve), { icon: "ant-design:check-outlined", color: "#FFFFFF", size: 12 })], 4)) : p("", true), void 0 !== d(o2)?.sqlQuery ? (s(), r(t3, { key: 1, "config-key": e2.configKey, "query-mode": e2.queryMode, "sql-query": d(o2).sqlQuery, level: e2.level - 1, "config-mitt": e2.configMitt, onConfigChange: z2 }, null, 8, ["config-key", "query-mode", "sql-query", "level", "config-mitt"])) : p("", true), (s(), r(Dl, { key: e2.configKey + d(C2).getFieldsChange, class: "config", "sql-query": d(o2), "query-mode": e2.queryMode, "config-mitt": e2.configMitt, onFieldChange: x2 }, null, 8, ["sql-query", "query-mode", "config-mitt"])), (s(), r(Jl, { level: e2.level, key: e2.configKey, class: "config", "sql-query": d(o2), "config-mitt": e2.configMitt, "query-mode": e2.queryMode, onJoinChange: A2 }, null, 8, ["level", "sql-query", "config-mitt", "query-mode"])), (s(), r(ta, { "query-mode": e2.queryMode, level: e2.level, key: e2.configKey, class: "config", "sql-query": d(o2), "config-mitt": e2.configMitt, onFilterChange: R2 }, null, 8, ["query-mode", "level", "sql-query", "config-mitt"])), (s(), r(xa, { "query-mode": e2.queryMode, level: e2.level, key: e2.configKey, class: "config", "sql-query": d(o2), "config-mitt": e2.configMitt, onCustomColChange: $2 }, null, 8, ["query-mode", "level", "sql-query", "config-mitt"])), (s(), r(ua, { "query-mode": e2.queryMode, key: e2.configKey, class: "config", "sql-query": d(o2), "config-mitt": e2.configMitt, onAggregateChange: O2, onGroupChange: j2, onDeleteAggregate: B2 }, null, 8, ["query-mode", "sql-query", "config-mitt"])), (s(), r(sa, { "query-mode": e2.queryMode, key: e2.configKey, class: "config", "sql-query": d(o2), "config-mitt": e2.configMitt, onOrderChange: D2 }, null, 8, ["query-mode", "sql-query", "config-mitt"])), (s(), r(Gl, { "query-mode": e2.queryMode, key: e2.configKey, class: "config", "sql-query": d(o2), "config-mitt": e2.configMitt, onLimitChange: P2 }, null, 8, ["query-mode", "sql-query", "config-mitt"])), q("div", Aa, [Q2.value ? (s(), r(Ul, { key: 0, class: "config-button", title: "关联", iconfont: "icon-mfish-join", level: e2.level, onClick: U2 }, null, 8, ["level"])) : p("", true), S2.value ? (s(), r(Ul, { key: 1, class: "config-button", title: "过滤", icon: "ant-design:filter-outlined", level: e2.level, onClick: L2 }, null, 8, ["level"])) : p("", true), T2.value ? (s(), r(Ul, { key: 2, class: "config-button", title: "自定义列", icon: "ant-design:insert-row-right-outlined", level: e2.level, onClick: H2 }, null, 8, ["level"])) : p("", true), N2.value ? (s(), r(Ul, { key: 3, class: "config-button", title: "聚合", iconfont: "icon-mfish-sum", level: e2.level, onClick: K2 }, null, 8, ["level"])) : p("", true), w2.value ? (s(), r(Ul, { key: 4, class: "config-button", title: "排序", icon: "ant-design:sort-ascending-outlined", level: e2.level, onClick: G2 }, null, 8, ["level"])) : p("", true), F2.value ? (s(), r(Ul, { key: 5, class: "config-button", title: "行数", icon: "ant-design:column-height-outlined", level: e2.level, onClick: W2 }, null, 8, ["level"])) : p("", true), b(Ul, { class: "config-button", ref_key: "querySqlRef", ref: m2, style: k({ fontWeight: "bold", border: `1px dashed ${d(i2)}` }), title: "查看SQL", icon: "ant-design:console-sql-outlined", level: e2.level, onClick: Y2 }, null, 8, ["style", "level"]), b(Ul, { class: "config-button", style: k({ fontWeight: "bold", border: `1px dashed ${d(i2)}` }), ref_key: "queryDataRef", ref: c2, title: "执行", onMouseenter: a3[0] || (a3[0] = (e3) => _2.value = true), onMouseleave: a3[1] || (a3[1] = (e3) => _2.value = false), icon: !d(C2).getShowData || d(C2).getShowDataLevel !== e2.level || _2.value ? "ant-design:caret-right-outlined" : "ant-design:check-outlined", level: e2.level, onClick: X2 }, null, 8, ["style", "icon", "level"])])], 2);
  };
} }), [["__scopeId", "data-v-6e75c78b"]]), Ia = { key: 0 }, $a = { key: 1 }, Oa = o({ __name: "SqlQueryModal", setup(e2) {
  const l2 = n(500), a2 = n(""), [t2, { setModalProps: o2 }] = qe(async (e3) => {
    o2({ width: "800px" }), a2.value = e3;
  }), { copy: u2, copied: i2 } = we({ legacy: true });
  function p2(e3) {
    l2.value = e3;
  }
  return (e3, o3) => {
    const n2 = g("AButton");
    return s(), r(d(be), w(e3.$attrs, { onRegister: d(t2), title: "SQL查看", "show-ok-btn": false, "cancel-text": "关闭", onHeightChange: p2 }), { insertFooter: c(() => [b(n2, { onClick: o3[0] || (o3[0] = (e4) => d(u2)(a2.value)), color: d(i2) ? "success" : "primary" }, { default: c(() => [d(i2) ? (s(), y("span", $a, "已拷贝")) : (s(), y("span", Ia, "拷贝"))]), _: 1 }, 8, ["color"])]), default: c(() => [b(d(Fe), { style: k({ height: `${l2.value}px` }), mode: d(xe).JS, value: a2.value, "onUpdate:value": o3[1] || (o3[1] = (e4) => a2.value = e4), readonly: true }, null, 8, ["style", "mode", "value"])]), _: 1 }, 16, ["onRegister"]);
  };
} });
export {
  ql as API_SAVE,
  gl as AggregateType,
  Ra as ApiConfig,
  Cl as ApiConfigEvent,
  yl as ExpressionType,
  vl as FilterCondition,
  Il as HttpBodyParam,
  Fl as HttpParamConfig,
  $l as HttpParams,
  Ta as ParamsModal,
  Oa as SqlQueryModal,
  Nl as buildSql,
  Ml as containNest,
  Be as deleteApiFolder,
  Ve as deleteApiParams,
  Xe as deleteBatchFormulaInfo,
  Ye as deleteFormulaInfo,
  ol as deleteMfApi,
  je as dragApiFolder,
  Ie as exportApiFolder,
  Pe as exportApiParams,
  Je as exportFormulaInfo,
  ll as exportMfApi,
  kl as formulaColName,
  rl as formulaTest,
  ml as getApiDataById,
  Re as getApiFolderAndFile,
  Ae as getApiFolderTree,
  De as getApiParamsList,
  Ze as getApiUrl,
  cl as getDataFieldsById,
  pl as getDataTableById,
  wl as getFieldIcon,
  Ke as getFormulaInfoById,
  He as getFormulaInfoList,
  Le as getFormulaParamList,
  Ue as getFormulaTree,
  _l as getInnerFields,
  nl as getMfApiById,
  el as getMfApiList,
  Tl as getParams,
  il as getQueryData,
  sl as getQueryFields,
  ul as getQuerySql,
  dl as getSourceHeaders,
  $e as insertApiFolder,
  ze as insertApiParams,
  Ge as insertFormulaInfo,
  al as insertMfApi,
  Ql as isNeedNest,
  Sl as queryDataEvent,
  fl as renameField,
  Oe as updateApiFolder,
  Ee as updateApiParams,
  We as updateFormulaInfo,
  tl as updateMfApi,
  hl as useApiShortcut,
  bl as useApiStore
};
